window.__require=function t(e,n,i){function o(c,s){if(!n[c]){if(!e[c]){var a=c.split("/");if(a=a[a.length-1],!e[a]){var u="function"==typeof __require&&__require;if(!s&&u)return u(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+c+"'")}c=a}var l=n[c]={exports:{}};e[c][0].call(l.exports,function(t){return o(e[c][1][t]||t)},l,l.exports,t,e,n,i)}return n[c].exports}for(var r="function"==typeof __require&&__require,c=0;c<i.length;c++)o(i[c]);return o}({BoosterAnimator:[function(t,e,n){"use strict";cc._RF.push(e,"443edlVMiVMk55BfN1I817M","BoosterAnimator"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.animateUse=function(t){if(t){t.stopAllActions();var e=cc.scaleTo(.2,.8).easing(cc.easeCubicActionOut()),n=cc.scaleTo(.2,1).easing(cc.easeBackOut()),i=cc.tintTo(.2,255,180,180);t.runAction(cc.sequence(cc.spawn(e,i),n,cc.tintTo(.1,255,255,255)))}},t.animateBomb=function(t){return t?new Promise(function(e){var n=cc.spawn(cc.scaleTo(.15,1.5).easing(cc.easeCubicActionOut()),cc.fadeOut(.15));t.runAction(cc.sequence(n,cc.callFunc(e)))}):Promise.resolve()},t.animateSelect=function(t){t&&(t.stopAllActions(),t.runAction(cc.scaleTo(.15,1.2).easing(cc.easeBackOut())))},t.animateTeleport=function(t,e){if(t&&e){var n=function(t){return t.runAction(cc.sequence(cc.scaleTo(.1,1.3),cc.scaleTo(.1,1)))};n(t),n(e)}},t.startActivePulse=function(t){if(t){t.stopAllActions();var e=cc.scaleTo(.4,1.1).easing(cc.easeSineInOut()),n=cc.scaleTo(.4,1).easing(cc.easeSineInOut()),i=cc.repeatForever(cc.sequence(e,n));t.runAction(i)}},t.stopActivePulse=function(t){t&&(t.stopAllActions(),t.runAction(cc.scaleTo(.2,1).easing(cc.easeBackOut())))},t.animateDepleted=function(t){if(t){var e=cc.fadeTo(.3,120),n=cc.tintTo(.3,180,180,180);t.runAction(cc.spawn(e,n))}},t}();n.default=i,cc._RF.pop()},{}],BoosterManager:[function(t,e,n){"use strict";cc._RF.push(e,"96b94+/vwFBRJevN2A4CYil","BoosterManager");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),r=this&&this.__decorate||function(t,e,n,i){var o,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(c=(r<3?o(c):r>3?o(e,n,c):o(e,n))||c);return r>3&&c&&Object.defineProperty(e,n,c),c},c=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function c(t){try{a(i.next(t))}catch(e){r(e)}}function s(t){try{a(i.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(c,s)}a((i=i.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var n,i,o,r,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(t){return function(e){return a([t,e])}}function a(r){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,i=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){c=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){c.label=r[1];break}if(6===r[0]&&c.label<o[1]){c.label=o[1],o=r;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(r);break}o[2]&&c.ops.pop(),c.trys.pop();continue}r=e.call(t,c)}catch(s){r=[6,s],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../animations/BoosterAnimator"),u=t("../animations/TileAnimator"),l=t("../core/EventManager"),p=t("../core/types"),f=t("./Tile"),h=cc._decorator.ccclass,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.grid=null,e.tileActions=null,e.activeBoosterType=null,e.activeBoosterNode=null,e.selectedTile=null,e.isWaitingForSecondTile=!1,e.isBusy=!1,e}return o(e,t),e.prototype.init=function(t,e){this.grid=t,this.tileActions=e,this.setupListeners()},e.prototype.onDestroy=function(){this.destroyListeners()},e.prototype.setupListeners=function(){l.default.getInstance().on("booster-activate-request",this.onBoosterActivateRequest,this)},e.prototype.destroyListeners=function(){l.default.getInstance().off("booster-activate-request",this.onBoosterActivateRequest,this)},e.prototype.onBoosterActivateRequest=function(t){var e=t.type,n=t.node;this.isBusy||(this.activeBoosterType!==e?(null!==this.activeBoosterType&&this.deactivateBooster(),this.activeBoosterNode=n,this.activeBoosterType=e,this.isWaitingForSecondTile=!1,a.default.startActivePulse(n)):this.deactivateBooster())},e.prototype.handleBoosterUsage=function(t,e){return c(this,void 0,Promise,function(){return s(this,function(n){switch(n.label){case 0:return null===this.activeBoosterType?[2]:this.activeBoosterType===p.BoosterType.Teleport&&this.isWaitingForSecondTile?[4,this.useTeleportBooster(t,e)]:[3,2];case 1:return n.sent(),[2];case 2:switch(this.activeBoosterType){case p.BoosterType.Bomb:return[3,3];case p.BoosterType.Teleport:return[3,5]}return[3,7];case 3:return[4,this.useBombBooster(t,e)];case 4:return n.sent(),[3,7];case 5:return[4,this.useTeleportBooster(t,e)];case 6:return n.sent(),[3,7];case 7:return[2]}})})},e.prototype.useBombBooster=function(t,e){return c(this,void 0,Promise,function(){var n,i,o,r,u,p,h=this;return s(this,function(d){switch(d.label){case 0:if(!this.grid)return[2];for(n=[],i=-1;i<=1;i++)for(o=-1;o<=1;o++)r=t+i,u=e+o,this.grid.isCoordinatesInsideGrid(r,u)&&n.push({x:r,y:u});return[4,Promise.all(n.map(function(t){var e=t.x,n=t.y;return c(h,void 0,void 0,function(){var t,i;return s(this,function(o){switch(o.label){case 0:return t=this.grid.getTileAt(e,n),(i=null==t?void 0:t.getComponent(f.default))?[4,a.default.animateBomb(t)]:[3,3];case 1:return o.sent(),[4,i.destroyTile()];case 2:o.sent(),this.grid.setTileAt(e,n,null),o.label=3;case 3:return[2]}})})}))];case 1:return d.sent(),p=10*n.length,l.default.getInstance().emit("score-changed",p),this.finishBoosterUsage(),[2]}})})},e.prototype.useTeleportBooster=function(t,e){return c(this,void 0,Promise,function(){var n,i,o,r,c;return s(this,function(s){switch(s.label){case 0:return this.grid&&this.tileActions?this.isWaitingForSecondTile?(this.isBusy=!0,n=this.grid.getTileAt(this.selectedTile.x,this.selectedTile.y),i=this.grid.getTileAt(t,e),n&&i?(o=n.getComponent(f.default),r=i.getComponent(f.default),o&&r?(a.default.stopActivePulse(n),[4,u.default.animateSwap(n,i)]):[3,3]):[3,3]):[3,4]:[2];case 1:return s.sent(),[4,this.tileActions.swapTiles(o,r)];case 2:s.sent(),s.label=3;case 3:return this.finishBoosterUsage(),[3,5];case 4:this.selectedTile={x:t,y:e},(c=this.grid.getTileAt(t,e))&&a.default.startActivePulse(c),this.isWaitingForSecondTile=!0,s.label=5;case 5:return[2]}})})},e.prototype.deactivateBooster=function(){if(this.activeBoosterNode&&(a.default.stopActivePulse(this.activeBoosterNode),this.activeBoosterNode=null),this.selectedTile&&this.grid){var t=this.grid.getTileAt(this.selectedTile.x,this.selectedTile.y);t&&a.default.stopActivePulse(t)}this.activeBoosterType=null,this.isWaitingForSecondTile=!1,this.selectedTile=null},e.prototype.finishBoosterUsage=function(){this.activeBoosterNode&&(a.default.stopActivePulse(this.activeBoosterNode),this.activeBoosterNode=null),l.default.getInstance().emit("booster-action-complete",this.activeBoosterType),this.activeBoosterType=null,this.isWaitingForSecondTile=!1,this.selectedTile=null,this.isBusy=!1},r([h],e)}(cc.Component);n.default=d,cc._RF.pop()},{"../animations/BoosterAnimator":"BoosterAnimator","../animations/TileAnimator":"TileAnimator","../core/EventManager":"EventManager","../core/types":"types","./Tile":"Tile"}],BoosterUI:[function(t,e,n){"use strict";cc._RF.push(e,"3d6f4G07c5PlaO/smsVD203","BoosterUI");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),r=this&&this.__decorate||function(t,e,n,i){var o,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(c=(r<3?o(c):r>3?o(e,n,c):o(e,n))||c);return r>3&&c&&Object.defineProperty(e,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var c=t("../core/EventManager"),s=t("./Booster"),a=cc._decorator,u=a.ccclass,l=a.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boosterComponent=null,e.quantityLabel=null,e}return o(e,t),e.prototype.start=function(){this.updateQuantityLabel(),this.setupListeners()},e.prototype.onDestroy=function(){this.destroyListeners()},e.prototype.onClick=function(){this.boosterComponent.quantity<=0||c.default.getInstance().emit("booster-activate-request",{type:this.boosterComponent.getBoosterType(),node:this.boosterComponent.node})},e.prototype.setupListeners=function(){this.node.on(cc.Node.EventType.TOUCH_END,this.onClick,this);var t=c.default.getInstance();t.on("booster-updated",this.onBoosterUpdated,this),t.on("booster-action-complete",this.onBoosterUsed,this)},e.prototype.destroyListeners=function(){this.node.off(cc.Node.EventType.TOUCH_END,this.onClick,this);var t=c.default.getInstance();t.off("booster-updated",this.onBoosterUpdated,this),t.off("booster-action-complete",this.onBoosterUsed,this)},e.prototype.onBoosterUpdated=function(t){var e=t.type,n=t.quantity;e===this.boosterComponent.getBoosterType()&&(this.boosterComponent.quantity=n,this.updateQuantityLabel())},e.prototype.onBoosterUsed=function(t){t===this.boosterComponent.getBoosterType()&&(this.boosterComponent.useOne(),this.updateQuantityLabel())},e.prototype.updateQuantityLabel=function(){this.quantityLabel&&(this.quantityLabel.string=""+this.boosterComponent.quantity)},r([l(s.default)],e.prototype,"boosterComponent",void 0),r([l(cc.Label)],e.prototype,"quantityLabel",void 0),r([u],e)}(cc.Component);n.default=p,cc._RF.pop()},{"../core/EventManager":"EventManager","./Booster":"Booster"}],Booster:[function(t,e,n){"use strict";cc._RF.push(e,"696cbVRBzpB+akFp3YVXcQa","Booster");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),r=this&&this.__decorate||function(t,e,n,i){var o,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(c=(r<3?o(c):r>3?o(e,n,c):o(e,n))||c);return r>3&&c&&Object.defineProperty(e,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var c=t("../animations/BoosterAnimator"),s=t("../core/EventManager"),a=t("../core/types"),u=cc._decorator,l=u.ccclass,p=u.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.quantity=0,e.boosterType=a.BoosterType.Bomb,e}return o(e,t),e.prototype.getBoosterType=function(){return this.boosterType},e.prototype.hasAvailable=function(){return this.quantity>0},e.prototype.useOne=function(){this.hasAvailable()&&(this.quantity--,s.default.getInstance().emit("booster-updated",{type:this.boosterType,quantity:this.quantity}),c.default.animateUse(this.node))},r([p(cc.Integer)],e.prototype,"quantity",void 0),r([p({type:cc.Enum(a.BoosterType)})],e.prototype,"boosterType",void 0),r([l],e)}(cc.Component);n.default=f,cc._RF.pop()},{"../animations/BoosterAnimator":"BoosterAnimator","../core/EventManager":"EventManager","../core/types":"types"}],EndGameScreenAnimator:[function(t,e,n){"use strict";cc._RF.push(e,"6a76annXjZNE61f/HUC2W3r","EndGameScreenAnimator"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.show=function(t,e){if(void 0===e&&(e=.3),t){t.scale=.8,t.opacity=0,t.stopAllActions();var n=cc.spawn(cc.scaleTo(e,1).easing(cc.easeBackOut()),cc.fadeIn(e));t.runAction(n)}},t.hide=function(t,e){if(void 0===e&&(e=.2),t){t.stopAllActions();var n=cc.spawn(cc.scaleTo(e,.9).easing(cc.easeIn(.3)),cc.fadeOut(e));t.runAction(n)}},t}();n.default=i,cc._RF.pop()},{}],EventManager:[function(t,e,n){"use strict";cc._RF.push(e,"a8ee0wFFRFO54+B7OC3g+V0","EventManager");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),r=this&&this.__decorate||function(t,e,n,i){var o,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(c=(r<3?o(c):r>3?o(e,n,c):o(e,n))||c);return r>3&&c&&Object.defineProperty(e,n,c),c},c=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),o=0;for(e=0;e<n;e++)for(var r=arguments[e],c=0,s=r.length;c<s;c++,o++)i[o]=r[c];return i};Object.defineProperty(n,"__esModule",{value:!0});var s=cc._decorator.ccclass,a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}var n;return o(e,t),n=e,e.getInstance=function(){return n.instance},e.prototype.onLoad=function(){n.instance?this.destroy():(n.instance=this,cc.game.addPersistRootNode(this.node))},e.prototype.emit=function(t){for(var e,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];(e=this.node).emit.apply(e,c([t],n))},e.prototype.on=function(t,e,n){this.node.on(t,e,n)},e.prototype.off=function(t,e,n){this.node.off(t,e,n)},n=r([s],e)}(cc.Component);n.default=a,cc._RF.pop()},{}],GameStateManager:[function(t,e,n){"use strict";cc._RF.push(e,"e2ea24y/1tA8rOpUW5ppAGH","GameStateManager");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),r=this&&this.__decorate||function(t,e,n,i){var o,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(c=(r<3?o(c):r>3?o(e,n,c):o(e,n))||c);return r>3&&c&&Object.defineProperty(e,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var c=t("./EventManager"),s=cc._decorator.ccclass,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._state="playing",e.handleGameWin=function(){e.state="victory"},e.handleGameLose=function(){e.state="defeat"},e.handleGameRestart=function(){e.state="playing"},e}return o(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(t){this._state!==t&&(this._state=t,c.default.getInstance().emit("game-state-changed",t))},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.setupListeners()},e.prototype.onDestroy=function(){this.destroyListeners()},e.prototype.setupListeners=function(){var t=c.default.getInstance();t.on("game-win",this.handleGameWin,this),t.on("game-lose",this.handleGameLose,this),t.on("game-restart",this.handleGameRestart,this)},e.prototype.destroyListeners=function(){var t=c.default.getInstance();t.off("game-win",this.handleGameWin,this),t.off("game-lose",this.handleGameLose,this),t.off("game-restart",this.handleGameRestart,this)},r([s],e)}(cc.Component);n.default=a,cc._RF.pop()},{"./EventManager":"EventManager"}],GameStateUIController:[function(t,e,n){"use strict";cc._RF.push(e,"aaa8a5gOP9MqY39/8NwWDKU","GameStateUIController");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),r=this&&this.__decorate||function(t,e,n,i){var o,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(c=(r<3?o(c):r>3?o(e,n,c):o(e,n))||c);return r>3&&c&&Object.defineProperty(e,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var c=t("../animations/EndGameScreenAnimator"),s=t("./EventManager"),a=cc._decorator,u=a.ccclass,l=a.property,p={victory:{text:"\u0412\u044b\n\u043f\u043e\u0431\u0435\u0434\u0438\u043b\u0438!",color:new cc.Color(6,138,0,255)},defeat:{text:"\u0412\u044b\n\u043f\u0440\u043e\u0438\u0433\u0440\u0430\u043b\u0438",color:new cc.Color(172,0,0,255)}},f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.endGameScreen=null,e.titleLabel=null,e.restartButton=null,e.handleRestartClick=function(){s.default.getInstance().emit("game-restart")},e}return o(e,t),e.prototype.start=function(){this.hide(),this.setupListeners(),this.setupRestartButton()},e.prototype.onDestroy=function(){this.destroyListeners()},e.prototype.setupListeners=function(){s.default.getInstance().on("game-state-changed",this.onStateChanged,this)},e.prototype.destroyListeners=function(){s.default.getInstance().off("game-state-changed",this.onStateChanged,this),this.restartButton&&this.restartButton.node.off("click",this.handleRestartClick,this)},e.prototype.setupRestartButton=function(){this.restartButton&&this.restartButton.node.on("click",this.handleRestartClick)},e.prototype.onStateChanged=function(t){"playing"===t?this.hide():this.show(t)},e.prototype.show=function(t){var e=p[t];e&&this.endGameScreen&&this.titleLabel&&(this.titleLabel.string=e.text,this.titleLabel.node.color=e.color,this.endGameScreen.active=!0,c.default.show(this.endGameScreen))},e.prototype.hide=function(){var t=this;this.endGameScreen&&(c.default.hide(this.endGameScreen),this.scheduleOnce(function(){return t.endGameScreen.active=!1},.2))},r([l(cc.Node)],e.prototype,"endGameScreen",void 0),r([l(cc.Label)],e.prototype,"titleLabel",void 0),r([l(cc.Button)],e.prototype,"restartButton",void 0),r([u],e)}(cc.Component);n.default=f,cc._RF.pop()},{"../animations/EndGameScreenAnimator":"EndGameScreenAnimator","./EventManager":"EventManager"}],GridAppearAnimator:[function(t,e,n){"use strict";cc._RF.push(e,"5a8c40vKfhGTKUw4OMq2/tD","GridAppearAnimator");var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function c(t){try{a(i.next(t))}catch(e){r(e)}}function s(t){try{a(i.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(c,s)}a((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,i,o,r,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(t){return function(e){return a([t,e])}}function a(r){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,i=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){c=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){c.label=r[1];break}if(6===r[0]&&c.label<o[1]){c.label=o[1],o=r;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(r);break}o[2]&&c.ops.pop(),c.trys.pop();continue}r=e.call(t,c)}catch(s){r=[6,s],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t){void 0===t&&(t=.35),this.duration=t}return t.prototype.animateGridAppearance=function(t){return i(this,void 0,Promise,function(){var e,n=this;return o(this,function(i){switch(i.label){case 0:return e=[],t.forEachTile(function(i,o){var r=t.getTileAt(i,o);if(r){r.opacity=0,r.scale=.8;var c=cc.fadeIn(n.duration),s=cc.scaleTo(n.duration,1).easing(cc.easeBackOut()),a=cc.spawn(c,s),u=new Promise(function(t){r.runAction(cc.sequence(a,cc.callFunc(t)))});e.push(u)}}),[4,Promise.all(e)];case 1:return i.sent(),[2]}})})},t}();n.default=r,cc._RF.pop()},{}],GridManager:[function(t,e,n){"use strict";cc._RF.push(e,"2dd8a4ufPNJhYcUK2dIe3sk","GridManager");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),r=this&&this.__decorate||function(t,e,n,i){var o,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(c=(r<3?o(c):r>3?o(e,n,c):o(e,n))||c);return r>3&&c&&Object.defineProperty(e,n,c),c},c=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function c(t){try{a(i.next(t))}catch(e){r(e)}}function s(t){try{a(i.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(c,s)}a((i=i.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var n,i,o,r,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(t){return function(e){return a([t,e])}}function a(r){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,i=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){c=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){c.label=r[1];break}if(6===r[0]&&c.label<o[1]){c.label=o[1],o=r;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(r);break}o[2]&&c.ops.pop(),c.trys.pop();continue}r=e.call(t,c)}catch(s){r=[6,s],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../core/EventManager"),u=t("./GridRepository"),l=t("./TileFactory"),p=t("./TileMatchManager"),f=t("./TileGravityManager"),h=t("./ReshuffleManager"),d=t("../core/PositionService"),y=t("../animations/GridAppearAnimator"),v=t("./TileActionExecutor"),g=t("./BoosterManager"),b=t("./TileTurnController"),m=cc._decorator,T=m.ccclass,_=m.property,w=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tilePrefab=null,e.gridWidth=0,e.gridHeight=0,e.tileSize=0,e.tileTypesCount=0,e.grid=null,e.positionService=null,e.factory=null,e.matcher=null,e.gravity=null,e.reshuffler=null,e.appearAnimator=null,e.tileActions=null,e.boosterManager=null,e.interactionService=null,e}return o(e,t),e.prototype.start=function(){return c(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return this.initServices(),this.setupListeners(),[4,this.createInitialGrid()];case 1:return t.sent(),[4,this.reshuffler.checkAndReshuffle()];case 2:return t.sent(),[2]}})})},e.prototype.onDestroy=function(){this.destroyListeners()},e.prototype.initServices=function(){this.grid=new u.default(this.gridWidth,this.gridHeight,this.tileSize,this.tileTypesCount),this.positionService=new d.default(this.grid),this.factory=new l.default(this.tilePrefab,this.node,this.positionService,this.grid),this.matcher=new p.default(this.grid),this.gravity=new f.default,this.gravity.init(this.grid,this.factory,this.positionService),this.reshuffler=new h.default,this.reshuffler.init(this.grid,this.factory,this.matcher),this.appearAnimator=new y.default,this.tileActions=new v.default(this.grid,this.positionService),this.boosterManager=this.node.addComponent(g.default),this.boosterManager.init(this.grid,this.tileActions),this.interactionService=new b.default(this.grid,this.matcher,this.tileActions,this.gravity,this.reshuffler,this.boosterManager,this.node)},e.prototype.setupListeners=function(){var t=a.default.getInstance();t.on("tile-clicked",this.interactionService.onTileClicked,this.interactionService),t.on("game-restart",this.onGameRestart,this)},e.prototype.destroyListeners=function(){var t=a.default.getInstance();t.off("tile-clicked",this.interactionService.onTileClicked,this.interactionService),t.off("game-restart",this.onGameRestart,this)},e.prototype.createInitialGrid=function(){return c(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return this.factory.populateField(this.grid),[4,this.appearAnimator.animateGridAppearance(this.grid)];case 1:return t.sent(),[2]}})})},e.prototype.onGameRestart=function(){return c(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return this.clearGrid(),this.reshuffler.reset(),[4,this.createInitialGrid()];case 1:return t.sent(),[2]}})})},e.prototype.clearGrid=function(){var t=this;this.grid&&this.grid.forEachTile(function(e,n){var i=t.grid.getTileAt(e,n);null==i||i.destroy(),t.grid.setTileAt(e,n,null)})},r([_(cc.Prefab)],e.prototype,"tilePrefab",void 0),r([_(cc.Integer)],e.prototype,"gridWidth",void 0),r([_(cc.Integer)],e.prototype,"gridHeight",void 0),r([_(cc.Integer)],e.prototype,"tileSize",void 0),r([_(cc.Integer)],e.prototype,"tileTypesCount",void 0),r([T],e)}(cc.Component);n.default=w,cc._RF.pop()},{"../animations/GridAppearAnimator":"GridAppearAnimator","../core/EventManager":"EventManager","../core/PositionService":"PositionService","./BoosterManager":"BoosterManager","./GridRepository":"GridRepository","./ReshuffleManager":"ReshuffleManager","./TileActionExecutor":"TileActionExecutor","./TileFactory":"TileFactory","./TileGravityManager":"TileGravityManager","./TileMatchManager":"TileMatchManager","./TileTurnController":"TileTurnController"}],GridRepository:[function(t,e,n){"use strict";cc._RF.push(e,"46bc1CkkP1LZJq8EyZjY7Jo","GridRepository"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e,n,i){this.tiles=[],this.width=t,this.height=e,this.tileSize=n,this.tileTypesCount=i,this.tiles=Array.from({length:e},function(){return Array(t).fill(null)})}return t.prototype.getTileAt=function(t,e){var n,i;return(null===(i=null===(n=this.tiles)||void 0===n?void 0:n[e])||void 0===i?void 0:i[t])||null},t.prototype.setTileAt=function(t,e,n){this.isCoordinatesInsideGrid(t,e)&&(this.tiles[e][t]=n)},t.prototype.forEachTile=function(t){for(var e=0;e<this.height;e++)for(var n=0;n<this.width;n++)t(n,e)},t.prototype.someTile=function(t){for(var e=0;e<this.height;e++)for(var n=0;n<this.width;n++)if(t(n,e))return!0;return!1},t.prototype.isCoordinatesInsideGrid=function(t,e){return t>=0&&e>=0&&t<this.width&&e<this.height},t}();n.default=i,cc._RF.pop()},{}],MoveCounterAnimator:[function(t,e,n){"use strict";cc._RF.push(e,"3041eFPnM5NuZW/XeYl8cAz","MoveCounterAnimator"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.animateDecrement=function(t){if(t){t.stopAllActions();var e=cc.scaleTo(.15,1.2).easing(cc.easeCubicActionOut()),n=cc.scaleTo(.15,1).easing(cc.easeBackOut()),i=cc.fadeTo(.15,150),o=cc.fadeTo(.15,255),r=cc.spawn(cc.sequence(e,n),cc.sequence(i,o));t.runAction(r)}},t.animateReset=function(t){if(t){t.stopAllActions(),t.opacity=0,t.scale=.8;var e=cc.spawn(cc.fadeIn(.25),cc.scaleTo(.25,1).easing(cc.easeBackOut()));t.runAction(e)}},t}();n.default=i,cc._RF.pop()},{}],MoveManager:[function(t,e,n){"use strict";cc._RF.push(e,"adf67vvHf1PkrfCzioi+YMe","MoveManager");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),r=this&&this.__decorate||function(t,e,n,i){var o,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(c=(r<3?o(c):r>3?o(e,n,c):o(e,n))||c);return r>3&&c&&Object.defineProperty(e,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var c=t("../animations/MoveCounterAnimator"),s=t("./EventManager"),a=cc._decorator,u=a.ccclass,l=a.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.moveLabel=null,e.initialMoves=37,e.movesCount=0,e}return o(e,t),e.prototype.onLoad=function(){this.resetMoves(),this.updateLabel()},e.prototype.start=function(){this.setupListeners()},e.prototype.onDestroy=function(){this.destroyListeners(),this.resetMoves()},e.prototype.setupListeners=function(){var t=s.default.getInstance();t.on("moves-changed",this.onMovesChanged,this),t.on("game-restart",this.onGameRestart,this)},e.prototype.destroyListeners=function(){var t=s.default.getInstance();t.off("moves-changed",this.onMovesChanged,this),t.off("game-restart",this.onGameRestart,this)},e.prototype.updateLabel=function(){this.moveLabel&&(this.moveLabel.string=String(this.movesCount))},e.prototype.onMovesChanged=function(){this.decrementMove(),this.updateLabel(),this.moveLabel&&c.default.animateDecrement(this.moveLabel.node),this.movesCount<=0&&s.default.getInstance().emit("game-lose")},e.prototype.onGameRestart=function(){this.resetMoves(),this.updateLabel(),this.moveLabel&&c.default.animateReset(this.moveLabel.node)},e.prototype.decrementMove=function(){this.movesCount>0&&this.movesCount--},e.prototype.resetMoves=function(){this.movesCount=this.initialMoves},r([l(cc.Label)],e.prototype,"moveLabel",void 0),r([l(cc.Integer)],e.prototype,"initialMoves",void 0),r([u],e)}(cc.Component);n.default=p,cc._RF.pop()},{"../animations/MoveCounterAnimator":"MoveCounterAnimator","./EventManager":"EventManager"}],PositionService:[function(t,e,n){"use strict";cc._RF.push(e,"c0825ixN55Kkq32ufh0FD4m","PositionService"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t){this.grid=t}return t.prototype.getTileWorldPosition=function(t,e){var n=this.grid.width*this.grid.tileSize,i=this.grid.height*this.grid.tileSize,o=n/2-this.grid.tileSize/2,r=i/2-this.grid.tileSize/2;return cc.v2(t*this.grid.tileSize-o,e*this.grid.tileSize-r)},t}();n.default=i,cc._RF.pop()},{}],ReshuffleManager:[function(t,e,n){"use strict";cc._RF.push(e,"2f39atwlaxAg4PFZIsbo1O5","ReshuffleManager");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),r=this&&this.__decorate||function(t,e,n,i){var o,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(c=(r<3?o(c):r>3?o(e,n,c):o(e,n))||c);return r>3&&c&&Object.defineProperty(e,n,c),c},c=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function c(t){try{a(i.next(t))}catch(e){r(e)}}function s(t){try{a(i.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(c,s)}a((i=i.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var n,i,o,r,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(t){return function(e){return a([t,e])}}function a(r){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,i=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){c=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){c.label=r[1];break}if(6===r[0]&&c.label<o[1]){c.label=o[1],o=r;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(r);break}o[2]&&c.ops.pop(),c.trys.pop();continue}r=e.call(t,c)}catch(s){r=[6,s],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../animations/GridAppearAnimator"),u=t("../core/EventManager"),l=t("./Tile"),p=cc._decorator.ccclass,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.maxReshuffles=3,e.reshuffleCount=0,e.appearAnimator=new a.default,e.grid=null,e.factory=null,e.matcher=null,e}return o(e,t),e.prototype.init=function(t,e,n){this.grid=t,this.factory=e,this.matcher=n},e.prototype.checkAndReshuffle=function(){return c(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return this.hasAvailableMoves()?[2,!0]:this.reshuffleCount>=this.maxReshuffles?(u.default.getInstance().emit("game-lose"),[2,!1]):[4,this.reshuffleField()];case 1:return t.sent(),[2,this.checkAndReshuffle()]}})})},e.prototype.hasAvailableMoves=function(){var t=this;return!(!this.grid||!this.matcher)&&this.grid.someTile(function(e,n){var i=t.grid.getTileAt(e,n).getComponent(l.default);return!!i&&t.matcher.findConnectedTiles(e,n,i.getTileType()).length>=2})},e.prototype.reshuffleField=function(){return c(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return this.grid&&this.factory?(this.reshuffleCount++,this.clearField(),this.factory.populateField(this.grid),[4,this.appearAnimator.animateGridAppearance(this.grid)]):[2];case 1:return t.sent(),[2]}})})},e.prototype.clearField=function(){var t=this;this.grid&&this.grid.forEachTile(function(e,n){var i=t.grid.getTileAt(e,n);null==i||i.destroy(),t.grid.setTileAt(e,n,null)})},e.prototype.reset=function(){this.reshuffleCount=0},r([p],e)}(cc.Component);n.default=f,cc._RF.pop()},{"../animations/GridAppearAnimator":"GridAppearAnimator","../core/EventManager":"EventManager","./Tile":"Tile"}],ScoreAnimator:[function(t,e,n){"use strict";cc._RF.push(e,"061ben6R8ZH+YAGKdEBy4bA","ScoreAnimator"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.animateScoreChange=function(t,e,n){if(t){t.stopAllActions();var i=cc.scaleTo(.15,1.25).easing(cc.easeCubicActionOut()),o=cc.scaleTo(.15,1).easing(cc.easeBackOut()),r=cc.sequence(i,o),c=n>e?cc.tintTo(.15,0,255,120):cc.tintTo(.15,255,255,255),s=cc.tintTo(.15,255,255,255);t.runAction(cc.sequence(cc.spawn(r,c),s))}},t.animateReset=function(t){if(t){t.stopAllActions(),t.opacity=0,t.scale=.8;var e=cc.spawn(cc.fadeIn(.25),cc.scaleTo(.25,1).easing(cc.easeBackOut()));t.runAction(e)}},t}();n.default=i,cc._RF.pop()},{}],ScoreManager:[function(t,e,n){"use strict";cc._RF.push(e,"042ebiihqBKB6cDdZGn/5tO","ScoreManager");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),r=this&&this.__decorate||function(t,e,n,i){var o,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(c=(r<3?o(c):r>3?o(e,n,c):o(e,n))||c);return r>3&&c&&Object.defineProperty(e,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var c=t("../animations/ScoreAnimator"),s=t("./EventManager"),a=cc._decorator,u=a.ccclass,l=a.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scoreLabel=null,e.totalScore=500,e.earnedScore=0,e}return o(e,t),e.prototype.start=function(){this.updateLabel(),this.setupListeners()},e.prototype.onDestroy=function(){this.destroyListeners(),this.resetScore()},e.prototype.setupListeners=function(){var t=s.default.getInstance();t.on("score-changed",this.onScoreChanged,this),t.on("game-restart",this.onGameRestart,this)},e.prototype.destroyListeners=function(){var t=s.default.getInstance();t.off("score-changed",this.onScoreChanged,this),t.off("game-restart",this.onGameRestart,this)},e.prototype.onGameRestart=function(){this.resetScore(),this.updateLabel(),this.scoreLabel&&c.default.animateReset(this.scoreLabel.node)},e.prototype.onScoreChanged=function(t){var e=this.earnedScore;this.earnedScore=Math.min(this.earnedScore+t,this.totalScore),this.updateLabel(),this.scoreLabel&&c.default.animateScoreChange(this.scoreLabel.node,e,this.earnedScore),this.earnedScore>=this.totalScore&&s.default.getInstance().emit("game-win")},e.prototype.updateLabel=function(){this.scoreLabel&&(this.scoreLabel.string=this.earnedScore+"/"+this.totalScore)},e.prototype.resetScore=function(){this.earnedScore=0},r([l(cc.Label)],e.prototype,"scoreLabel",void 0),r([l(cc.Integer)],e.prototype,"totalScore",void 0),r([l(cc.Integer)],e.prototype,"earnedScore",void 0),r([u],e)}(cc.Component);n.default=p,cc._RF.pop()},{"../animations/ScoreAnimator":"ScoreAnimator","./EventManager":"EventManager"}],TileActionExecutor:[function(t,e,n){"use strict";cc._RF.push(e,"8dab3JyZWVEwKJeubgTTBSV","TileActionExecutor");var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function c(t){try{a(i.next(t))}catch(e){r(e)}}function s(t){try{a(i.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(c,s)}a((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,i,o,r,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(t){return function(e){return a([t,e])}}function a(r){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,i=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){c=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){c.label=r[1];break}if(6===r[0]&&c.label<o[1]){c.label=o[1],o=r;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(r);break}o[2]&&c.ops.pop(),c.trys.pop();continue}r=e.call(t,c)}catch(s){r=[6,s],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var r=t("./Tile"),c=t("../core/types"),s=t("../animations/TileAnimator"),a=function(){function t(t,e){this.grid=t,this.positionService=e}return t.prototype.destroyConnectedTiles=function(t,e,n){return i(this,void 0,Promise,function(){var i,a,u,l,p;return o(this,function(o){switch(o.label){case 0:return i=this.determineSpecialType(t.length),a=i!==c.TileSpecialType.None,u=t.filter(function(t){var i=t.x,o=t.y;return!(i===e&&o===n&&a)}),[4,this.destroyTiles(u)];case 1:return o.sent(),a&&(l=this.grid.getTileAt(e,n),(p=null==l?void 0:l.getComponent(r.default))&&(p.transformToSpecial(i),s.default.animateSpecialTileCreate(l))),[2,10*t.length]}})})},t.prototype.activateSpecialTile=function(t){return i(this,void 0,Promise,function(){var e,n,i,r,s,a,u;return o(this,function(o){switch(o.label){case 0:switch(e=t.getGridPosition(),n=e.x,i=e.y,r=t.getSpecialType(),s=[],r){case c.TileSpecialType.Bomb:this.collectRadius(n,i,1,s);break;case c.TileSpecialType.RowRocket:for(a=0;a<this.grid.width;a++)s.push({x:a,y:i});break;case c.TileSpecialType.ColRocket:for(u=0;u<this.grid.height;u++)s.push({x:n,y:u});break;case c.TileSpecialType.SuperBomb:this.grid.forEachTile(function(t,e){return s.push({x:t,y:e})})}return[4,this.destroyTiles(s)];case 1:return o.sent(),[2,10*s.length]}})})},t.prototype.collectRadius=function(t,e,n,i){for(var o=-n;o<=n;o++)for(var r=-n;r<=n;r++){var c=t+o,s=e+r;this.grid.isCoordinatesInsideGrid(c,s)&&i.push({x:c,y:s})}},t.prototype.swapTiles=function(t,e){return i(this,void 0,Promise,function(){var n,i,r,c;return o(this,function(){return n=this.positionService.getTileWorldPosition(t.getGridPosition().x,t.getGridPosition().y),i=this.positionService.getTileWorldPosition(e.getGridPosition().x,e.getGridPosition().y),t.node.setPosition(i),e.node.setPosition(n),this.grid.setTileAt(e.getGridPosition().x,e.getGridPosition().y,t.node),this.grid.setTileAt(t.getGridPosition().x,t.getGridPosition().y,e.node),r=t.getGridPosition(),c=e.getGridPosition(),t.setGridPosition(c.x,c.y),e.setGridPosition(r.x,r.y),[2]})})},t.prototype.determineSpecialType=function(t){return t>=9?c.TileSpecialType.SuperBomb:t>=6?Math.random()<.5?c.TileSpecialType.RowRocket:c.TileSpecialType.ColRocket:t>=5?c.TileSpecialType.Bomb:c.TileSpecialType.None},t.prototype.destroyTiles=function(t){return i(this,void 0,Promise,function(){var e=this;return o(this,function(n){switch(n.label){case 0:return[4,Promise.all(t.map(function(t){var n=t.x,c=t.y;return i(e,void 0,void 0,function(){var t,e;return o(this,function(i){switch(i.label){case 0:return t=this.grid.getTileAt(n,c),(e=null==t?void 0:t.getComponent(r.default))?[4,e.destroyTile()]:[3,2];case 1:i.sent(),i.label=2;case 2:return this.grid.setTileAt(n,c,null),[2]}})})}))];case 1:return n.sent(),[2]}})})},t}();n.default=a,cc._RF.pop()},{"../animations/TileAnimator":"TileAnimator","../core/types":"types","./Tile":"Tile"}],TileAnimator:[function(t,e,n){"use strict";cc._RF.push(e,"1a9826ZP8tFUreSrUAn1ata","TileAnimator"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.animateFall=function(t,e,n){return void 0===n&&(n=.25),t?new Promise(function(i){t.runAction(cc.sequence(cc.moveTo(n,e).easing(cc.easeCubicActionOut()),cc.callFunc(function(){return i()})))}):Promise.resolve()},t.animateSwap=function(t,e){return t&&e?new Promise(function(n){var i=t.getPosition(),o=e.getPosition(),r=cc.scaleTo(.1,1.1).easing(cc.easeSineOut()),c=cc.scaleTo(.1,1).easing(cc.easeSineIn()),s=cc.moveTo(.25,o).easing(cc.easeCubicActionOut()),a=cc.moveTo(.25,i).easing(cc.easeCubicActionOut()),u=cc.sequence(r,s,c),l=cc.sequence(r.clone(),a,c.clone());t.runAction(u),e.runAction(l),t.runAction(cc.sequence(cc.delayTime(.35),cc.callFunc(function(){return n()})))}):Promise.resolve()},t.animateDestroy=function(t,e){return void 0===e&&(e=.25),new Promise(function(n){var i=cc.fadeOut(e),o=cc.scaleTo(e,0).easing(cc.easeBackIn()),r=cc.rotateBy(e,360*Math.random()*(Math.random()>.5?1:-1)),c=cc.spawn(i,o,r);t.runAction(cc.sequence(c,cc.callFunc(n)))})},t.animateSpecialTileCreate=function(t){return t?new Promise(function(e){t.scale=.8,t.opacity=0;var n=cc.fadeIn(.18),i=cc.scaleTo(.18,1).easing(cc.easeBackOut()),o=cc.spawn(n,i);t.runAction(cc.sequence(o,cc.callFunc(e)))}):Promise.resolve()},t.animateSpawn=function(t,e,n){return void 0===n&&(n=.1),t?new Promise(function(i){t.opacity=0,t.scale=.8;var o=cc.fadeIn(n),r=cc.moveTo(n,e).easing(cc.easeCubicActionOut()),c=cc.scaleTo(n,1).easing(cc.easeBackOut()),s=cc.spawn(o,r,c);t.runAction(cc.sequence(s,cc.callFunc(i)))}):Promise.resolve()},t}();n.default=i,cc._RF.pop()},{}],TileFactory:[function(t,e,n){"use strict";cc._RF.push(e,"ffe0670LXBJ5Lfk2ZAsSaXn","TileFactory");var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function c(t){try{a(i.next(t))}catch(e){r(e)}}function s(t){try{a(i.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(c,s)}a((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,i,o,r,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(t){return function(e){return a([t,e])}}function a(r){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,i=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){c=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){c.label=r[1];break}if(6===r[0]&&c.label<o[1]){c.label=o[1],o=r;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(r);break}o[2]&&c.ops.pop(),c.trys.pop();continue}r=e.call(t,c)}catch(s){r=[6,s],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var r=t("../animations/TileAnimator"),c=t("../core/types"),s=t("./Tile"),a=function(){function t(t,e,n,i){this.tilePrefab=t,this.parentNode=e,this.positionService=n,this.grid=i}return t.prototype.createTile=function(t,e,n,i,o){void 0===n&&(n=null),void 0===i&&(i=c.TileSpecialType.None),void 0===o&&(o=!1);var a=cc.instantiate(this.tilePrefab),u=a.getComponent(s.default);if(!u)throw new Error("Tile component missing on prefab");a.parent=this.parentNode,u.init(t,e,n||this.getRandomTileType(),this.positionService,i);var l=this.positionService.getTileWorldPosition(t,e);return a.setPosition(l),this.grid.setTileAt(t,e,a),o&&r.default.animateSpawn(a,l),a},t.prototype.createFallingTile=function(t,e,n,a,u){return void 0===u&&(u=c.TileSpecialType.None),i(this,void 0,Promise,function(){var i,c,l,p;return o(this,function(o){switch(o.label){case 0:if((i=cc.instantiate(this.tilePrefab)).parent=this.parentNode,!(c=i.getComponent(s.default)))throw new Error("Tile component missing on prefab");return c.init(t,n,a,this.positionService,u),l=this.positionService.getTileWorldPosition(t,e),p=this.positionService.getTileWorldPosition(t,n),i.setPosition(l),[4,r.default.animateFall(i,p)];case 1:return o.sent(),this.grid.setTileAt(t,n,i),[2]}})})},t.prototype.populateField=function(t){var e=this;this.grid.forEachTile(function(n,i){var o=e.createTile(n,i);o.setPosition(e.positionService.getTileWorldPosition(n,i)),t.setTileAt(n,i,o)})},t.prototype.getRandomTileType=function(){return Math.floor(Math.random()*this.grid.tileTypesCount)},t}();n.default=a,cc._RF.pop()},{"../animations/TileAnimator":"TileAnimator","../core/types":"types","./Tile":"Tile"}],TileGravityManager:[function(t,e,n){"use strict";cc._RF.push(e,"b3ba2+820tGq6moRAply4Sd","TileGravityManager");var i=this&&this.__decorate||function(t,e,n,i){var o,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(c=(r<3?o(c):r>3?o(e,n,c):o(e,n))||c);return r>3&&c&&Object.defineProperty(e,n,c),c},o=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function c(t){try{a(i.next(t))}catch(e){r(e)}}function s(t){try{a(i.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(c,s)}a((i=i.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){var n,i,o,r,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(t){return function(e){return a([t,e])}}function a(r){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,i=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){c=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){c.label=r[1];break}if(6===r[0]&&c.label<o[1]){c.label=o[1],o=r;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(r);break}o[2]&&c.ops.pop(),c.trys.pop();continue}r=e.call(t,c)}catch(s){r=[6,s],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=t("../animations/TileAnimator"),s=t("./Tile"),a=cc._decorator.ccclass,u=function(){function t(){this.grid=null,this.factory=null,this.positionService=null}return t.prototype.init=function(t,e,n){this.grid=t,this.factory=e,this.positionService=n},t.prototype.applyGravity=function(){return o(this,void 0,Promise,function(){var t,e,n,i,o,c,a,u,l,p,f;return r(this,function(r){switch(r.label){case 0:if(!this.grid)return[2];for(t=[],e=0;e<this.grid.width;e++){for(n=0,i=0;i<this.grid.height;i++)(o=this.grid.getTileAt(e,i))?n>0&&(c=i-n,(a=o.getComponent(s.default))&&(f=a.moveToGrid(e,c),t.push(f)),this.grid.setTileAt(e,c,o),this.grid.setTileAt(e,i,null)):n++;for(u=0;u<n;u++)l=this.grid.height+u,p=this.grid.height-n+u,f=this.createFallingTile(e,l,p),t.push(f)}return[4,Promise.all(t)];case 1:return r.sent(),[2]}})})},t.prototype.createFallingTile=function(t,e,n){return o(this,void 0,Promise,function(){var i,o,s;return r(this,function(r){switch(r.label){case 0:return i=this.factory.createTile(t,n),o=this.positionService.getTileWorldPosition(t,e),i.setPosition(o),s=this.positionService.getTileWorldPosition(t,n),[4,c.default.animateFall(i,s)];case 1:return r.sent(),i.setPosition(s),this.grid.setTileAt(t,n,i),[2]}})})},i([a],t)}();n.default=u,cc._RF.pop()},{"../animations/TileAnimator":"TileAnimator","./Tile":"Tile"}],TileMatchManager:[function(t,e,n){"use strict";cc._RF.push(e,"9bd5dDefbpI3aYvCI1YOj13","TileMatchManager"),Object.defineProperty(n,"__esModule",{value:!0});var i=t("./Tile"),o=function(){function t(t){this.grid=t}return t.prototype.findConnectedTiles=function(t,e,n){for(var o=new Set,r=[{x:t,y:e}],c=[],s=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}];r.length;){var a=r.pop();if(a){var u=a.x+"_"+a.y;if(!o.has(u)){o.add(u);var l=this.grid.getTileAt(a.x,a.y),p=null==l?void 0:l.getComponent(i.default);if(p&&p.getTileType()===n){c.push(a);for(var f=0,h=s;f<h.length;f++){var d=h[f],y=d.dx,v=d.dy,g=a.x+y,b=a.y+v;g>=0&&g<this.grid.width&&b>=0&&b<this.grid.height&&r.push({x:g,y:b})}}}}}return c},t}();n.default=o,cc._RF.pop()},{"./Tile":"Tile"}],TileTurnController:[function(t,e,n){"use strict";cc._RF.push(e,"6c6723lXFRDxLMU12g6dwuh","TileTurnController");var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function c(t){try{a(i.next(t))}catch(e){r(e)}}function s(t){try{a(i.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(c,s)}a((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,i,o,r,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(t){return function(e){return a([t,e])}}function a(r){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,i=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){c=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){c.label=r[1];break}if(6===r[0]&&c.label<o[1]){c.label=o[1],o=r;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(r);break}o[2]&&c.ops.pop(),c.trys.pop();continue}r=e.call(t,c)}catch(s){r=[6,s],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var r=t("../core/EventManager"),c=t("./Tile"),s=t("../core/types"),a=function(){function t(t,e,n,i,o,r,c){this.grid=t,this.matcher=e,this.tileActions=n,this.gravity=i,this.reshuffler=o,this.boosterManager=r,this.gridNode=c,this.isProcessing=!1}return t.prototype.onTileClicked=function(t){var e=t.x,n=t.y,c=t.tileType;return i(this,void 0,void 0,function(){var t;return o(this,function(i){switch(i.label){case 0:if(this.isProcessing)return[2];this.isProcessing=!0,i.label=1;case 1:return i.trys.push([1,,5,7]),[4,this.tryHandleBooster(e,n)];case 2:return i.sent()?[2]:(r.default.getInstance().emit("moves-changed"),(t=this.getTile(e,n))?[4,this.tryHandleSpecial(t)]:[2]);case 3:return i.sent()?[2]:[4,this.tryHandleConnected(e,n,c)];case 4:return i.sent(),[3,7];case 5:return[4,this.finalizeTurn()];case 6:return i.sent(),[7];case 7:return[2]}})})},t.prototype.getTile=function(t,e){var n,i=this.grid.getTileAt(t,e);return null!==(n=null==i?void 0:i.getComponent(c.default))&&void 0!==n?n:null},t.prototype.tryHandleBooster=function(t,e){return i(this,void 0,Promise,function(){return o(this,function(n){switch(n.label){case 0:return null===this.boosterManager.activeBoosterType?[2,!1]:[4,this.boosterManager.handleBoosterUsage(t,e)];case 1:return n.sent(),[2,!0]}})})},t.prototype.tryHandleSpecial=function(t){return i(this,void 0,Promise,function(){var e;return o(this,function(n){switch(n.label){case 0:return t.getSpecialType()===s.TileSpecialType.None?[2,!1]:[4,this.tileActions.activateSpecialTile(t)];case 1:return e=n.sent(),r.default.getInstance().emit("score-changed",e),[2,!0]}})})},t.prototype.tryHandleConnected=function(t,e,n){return i(this,void 0,Promise,function(){var i,c;return o(this,function(o){switch(o.label){case 0:return(i=this.matcher.findConnectedTiles(t,e,n)).length<2?[2]:[4,this.tileActions.destroyConnectedTiles(i,t,e)];case 1:return c=o.sent(),r.default.getInstance().emit("score-changed",c),[2]}})})},t.prototype.finalizeTurn=function(){return i(this,void 0,Promise,function(){return o(this,function(t){switch(t.label){case 0:return[4,this.gravity.applyGravity()];case 1:return t.sent(),[4,this.reshuffler.checkAndReshuffle()];case 2:return t.sent(),this.resortTilesByDepth(),this.isProcessing=!1,[2]}})})},t.prototype.resortTilesByDepth=function(){this.gridNode.children.forEach(function(t){t.zIndex=+t.y})},t}();n.default=a,cc._RF.pop()},{"../core/EventManager":"EventManager","../core/types":"types","./Tile":"Tile"}],Tile:[function(t,e,n){"use strict";cc._RF.push(e,"e0baamQ7/9KnL6Y7zqCTE8p","Tile");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),r=this&&this.__decorate||function(t,e,n,i){var o,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(c=(r<3?o(c):r>3?o(e,n,c):o(e,n))||c);return r>3&&c&&Object.defineProperty(e,n,c),c},c=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function c(t){try{a(i.next(t))}catch(e){r(e)}}function s(t){try{a(i.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(c,s)}a((i=i.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var n,i,o,r,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(t){return function(e){return a([t,e])}}function a(r){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,i=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){c=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){c.label=r[1];break}if(6===r[0]&&c.label<o[1]){c.label=o[1],o=r;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(r);break}o[2]&&c.ops.pop(),c.trys.pop();continue}r=e.call(t,c)}catch(s){r=[6,s],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../animations/TileAnimator"),u=t("../core/EventManager"),l=t("../core/types"),p=cc._decorator,f=p.ccclass,h=p.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tileSprites=[],e.specialSprites=[],e.sprite=null,e.positionService=null,e.tileType=0,e.specialType=l.TileSpecialType.None,e.gridX=0,e.gridY=0,e}return o(e,t),e.prototype.init=function(t,e,n,i,o){void 0===o&&(o=l.TileSpecialType.None),this.gridX=t,this.gridY=e,this.tileType=n,this.specialType=o,this.positionService=i},e.prototype.start=function(){this.updateSprite()},e.prototype.onLoad=function(){this.sprite=this.getComponent(cc.Sprite),this.setupListeners()},e.prototype.onDestroy=function(){this.destroyListeners()},e.prototype.setupListeners=function(){this.node.on(cc.Node.EventType.TOUCH_END,this.onClick,this)},e.prototype.destroyListeners=function(){this.node.off(cc.Node.EventType.TOUCH_END,this.onClick,this)},e.prototype.getGridPosition=function(){return{x:this.gridX,y:this.gridY}},e.prototype.setGridPosition=function(t,e){this.gridX=t,this.gridY=e},e.prototype.getTileType=function(){return this.tileType},e.prototype.getSpecialType=function(){return this.specialType},e.prototype.isSpecial=function(){return this.specialType!==l.TileSpecialType.None},e.prototype.moveToGrid=function(t,e){return c(this,void 0,Promise,function(){var n;return s(this,function(i){switch(i.label){case 0:return this.positionService?(this.gridX=t,this.gridY=e,n=this.positionService.getTileWorldPosition(t,e),[4,a.default.animateFall(this.node,n)]):[2];case 1:return i.sent(),[2]}})})},e.prototype.destroyTile=function(t){return void 0===t&&(t=.15),c(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return[4,a.default.animateDestroy(this.node,t)];case 1:return e.sent(),this.node.destroy(),[2]}})})},e.prototype.transformToSpecial=function(t){this.specialType=t,this.tileType=null,this.updateSprite()},e.prototype.onClick=function(){u.default.getInstance().emit("tile-clicked",{x:this.gridX,y:this.gridY,tileType:this.tileType,specialType:this.specialType})},e.prototype.updateSprite=function(){this.sprite&&(this.isSpecial()&&this.specialSprites[this.specialType]?this.sprite.spriteFrame=this.specialSprites[this.specialType]:this.tileSprites[this.tileType]&&(this.sprite.spriteFrame=this.tileSprites[this.tileType]))},r([h([cc.SpriteFrame])],e.prototype,"tileSprites",void 0),r([h([cc.SpriteFrame])],e.prototype,"specialSprites",void 0),r([f],e)}(cc.Component);n.default=d,cc._RF.pop()},{"../animations/TileAnimator":"TileAnimator","../core/EventManager":"EventManager","../core/types":"types"}],types:[function(t,e,n){"use strict";cc._RF.push(e,"cd7f7KZW8VCcb55XaXGqnMe","types"),Object.defineProperty(n,"__esModule",{value:!0}),n.BoosterType=n.TileSpecialType=void 0,function(t){t[t.None=0]="None",t[t.Bomb=1]="Bomb",t[t.RowRocket=2]="RowRocket",t[t.ColRocket=3]="ColRocket",t[t.SuperBomb=4]="SuperBomb"}(n.TileSpecialType||(n.TileSpecialType={})),function(t){t[t.Bomb=0]="Bomb",t[t.Teleport=1]="Teleport"}(n.BoosterType||(n.BoosterType={})),cc._RF.pop()},{}]},{},["BoosterAnimator","EndGameScreenAnimator","GridAppearAnimator","MoveCounterAnimator","ScoreAnimator","TileAnimator","EventManager","GameStateManager","GameStateUIController","MoveManager","PositionService","ScoreManager","types","Booster","BoosterManager","BoosterUI","GridManager","GridRepository","ReshuffleManager","Tile","TileActionExecutor","TileFactory","TileGravityManager","TileMatchManager","TileTurnController"]);