window.__require=function e(t,n,i){function o(s,c){if(!n[s]){if(!t[s]){var a=s.split("/");if(a=a[a.length-1],!t[a]){var l="function"==typeof __require&&__require;if(!c&&l)return l(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+s+"'")}s=a}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){return o(t[s][1][e]||e)},u,u.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<i.length;s++)o(i[s]);return o}({BoosterAnimator:[function(e,t,n){"use strict";cc._RF.push(t,"443edlVMiVMk55BfN1I817M","BoosterAnimator"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(){}return e.animateUse=function(e){if(e){e.stopAllActions();var t=cc.scaleTo(.2,.8).easing(cc.easeCubicActionOut()),n=cc.scaleTo(.2,1).easing(cc.easeBackOut()),i=cc.tintTo(.2,255,180,180);e.runAction(cc.sequence(cc.spawn(t,i),n,cc.tintTo(.1,255,255,255)))}},e.animateBomb=function(e){return e?new Promise(function(t){var n=cc.spawn(cc.scaleTo(.15,1.5).easing(cc.easeCubicActionOut()),cc.fadeOut(.15));e.runAction(cc.sequence(n,cc.callFunc(t)))}):Promise.resolve()},e.animateSelect=function(e){e&&(e.stopAllActions(),e.runAction(cc.scaleTo(.15,1.2).easing(cc.easeBackOut())))},e.animateTeleport=function(e,t){if(e&&t){var n=function(e){return e.runAction(cc.sequence(cc.scaleTo(.1,1.3),cc.scaleTo(.1,1)))};n(e),n(t)}},e.startActivePulse=function(e){if(e){e.stopAllActions();var t=cc.scaleTo(.4,1.1).easing(cc.easeSineInOut()),n=cc.scaleTo(.4,1).easing(cc.easeSineInOut()),i=cc.repeatForever(cc.sequence(t,n));e.runAction(i)}},e.stopActivePulse=function(e){e&&(e.stopAllActions(),e.runAction(cc.scaleTo(.2,1).easing(cc.easeBackOut())))},e.animateDepleted=function(e){if(e){var t=cc.fadeTo(.3,120),n=cc.tintTo(.3,180,180,180);e.runAction(cc.spawn(t,n))}},e}();n.default=i,cc._RF.pop()},{}],BoosterManager:[function(e,t,n){"use strict";cc._RF.push(t,"96b94+/vwFBRJevN2A4CYil","BoosterManager");var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(t){r(t)}}function c(e){try{a(i.throw(e))}catch(t){r(t)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,c)}a((i=i.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(e){return function(t){return a([e,t])}}function a(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(c){r=[6,c],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../animations/boosters/BoosterAnimator"),l=e("../animations/tiles/TileAnimator"),u=e("../core/events/EventManager"),p=e("../core/types"),f=e("../domain/entities/Tile"),h=cc._decorator.ccclass,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.grid=null,t.tileActions=null,t.activeBoosterType=null,t.activeBoosterNode=null,t.selectedTile=null,t.isWaitingForSecondTile=!1,t.isBusy=!1,t}return o(t,e),t.prototype.init=function(e,t){this.grid=e,this.tileActions=t,this.setupListeners()},t.prototype.onDestroy=function(){this.destroyListeners()},t.prototype.setupListeners=function(){u.default.getInstance().on("booster-activate-request",this.onBoosterActivateRequest,this)},t.prototype.destroyListeners=function(){u.default.getInstance().off("booster-activate-request",this.onBoosterActivateRequest,this)},t.prototype.onBoosterActivateRequest=function(e){var t=e.type,n=e.node;this.isBusy||(this.activeBoosterType!==t?(null!==this.activeBoosterType&&this.deactivateBooster(),this.activeBoosterNode=n,this.activeBoosterType=t,this.isWaitingForSecondTile=!1,a.default.startActivePulse(n)):this.deactivateBooster())},t.prototype.handleBoosterUsage=function(e,t){return s(this,void 0,Promise,function(){return c(this,function(n){switch(n.label){case 0:return null===this.activeBoosterType?[2]:this.activeBoosterType===p.BoosterType.Teleport&&this.isWaitingForSecondTile?[4,this.useTeleportBooster(e,t)]:[3,2];case 1:return n.sent(),[2];case 2:switch(this.activeBoosterType){case p.BoosterType.Bomb:return[3,3];case p.BoosterType.Teleport:return[3,5]}return[3,7];case 3:return[4,this.useBombBooster(e,t)];case 4:return n.sent(),[3,7];case 5:return[4,this.useTeleportBooster(e,t)];case 6:return n.sent(),[3,7];case 7:return[2]}})})},t.prototype.useBombBooster=function(e,t){return s(this,void 0,Promise,function(){var n,i,o,r,s,a;return c(this,function(c){switch(c.label){case 0:if(!this.grid||!this.tileActions)return[2];for(n=[],i=-1;i<=1;i++)for(o=-1;o<=1;o++)r=e+i,s=t+o,this.grid.isCoordinatesInsideGrid(r,s)&&n.push({x:r,y:s});return[4,this.tileActions.destroyTilesWithChain(n)];case 1:return a=c.sent(),u.default.getInstance().emit("score-changed",a),this.finishBoosterUsage(),[2]}})})},t.prototype.useTeleportBooster=function(e,t){return s(this,void 0,Promise,function(){var n,i,o,r,s;return c(this,function(c){switch(c.label){case 0:return this.grid&&this.tileActions?this.isWaitingForSecondTile?(this.isBusy=!0,n=this.grid.getTileAt(this.selectedTile.x,this.selectedTile.y),i=this.grid.getTileAt(e,t),n&&i?(o=n.getComponent(f.default),r=i.getComponent(f.default),o&&r?(a.default.stopActivePulse(n),[4,l.default.animateSwap(n,i)]):[3,3]):[3,3]):[3,4]:[2];case 1:return c.sent(),[4,this.tileActions.swapTiles(o,r)];case 2:c.sent(),c.label=3;case 3:return this.finishBoosterUsage(),[3,5];case 4:this.selectedTile={x:e,y:t},(s=this.grid.getTileAt(e,t))&&a.default.startActivePulse(s),this.isWaitingForSecondTile=!0,c.label=5;case 5:return[2]}})})},t.prototype.deactivateBooster=function(){if(this.activeBoosterNode&&(a.default.stopActivePulse(this.activeBoosterNode),this.activeBoosterNode=null),this.selectedTile&&this.grid){var e=this.grid.getTileAt(this.selectedTile.x,this.selectedTile.y);e&&a.default.stopActivePulse(e)}this.activeBoosterType=null,this.isWaitingForSecondTile=!1,this.selectedTile=null},t.prototype.finishBoosterUsage=function(){this.activeBoosterNode&&(a.default.stopActivePulse(this.activeBoosterNode),this.activeBoosterNode=null),u.default.getInstance().emit("booster-action-complete",this.activeBoosterType),this.activeBoosterType=null,this.isWaitingForSecondTile=!1,this.selectedTile=null,this.isBusy=!1},r([h],t)}(cc.Component);n.default=d,cc._RF.pop()},{"../animations/boosters/BoosterAnimator":"BoosterAnimator","../animations/tiles/TileAnimator":"TileAnimator","../core/events/EventManager":"EventManager","../core/types":"types","../domain/entities/Tile":"Tile"}],BoosterUI:[function(e,t,n){"use strict";cc._RF.push(t,"3d6f4G07c5PlaO/smsVD203","BoosterUI");var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../core/events/EventManager"),c=e("../domain/entities/Booster"),a=cc._decorator,l=a.ccclass,u=a.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.boosterComponent=null,t.quantityLabel=null,t}return o(t,e),t.prototype.start=function(){this.updateQuantityLabel(),this.setupListeners()},t.prototype.onDestroy=function(){this.destroyListeners()},t.prototype.onClick=function(){this.boosterComponent.quantity<=0||s.default.getInstance().emit("booster-activate-request",{type:this.boosterComponent.getBoosterType(),node:this.boosterComponent.node})},t.prototype.setupListeners=function(){this.node.on(cc.Node.EventType.TOUCH_END,this.onClick,this);var e=s.default.getInstance();e.on("booster-updated",this.onBoosterUpdated,this),e.on("booster-action-complete",this.onBoosterUsed,this)},t.prototype.destroyListeners=function(){this.node.off(cc.Node.EventType.TOUCH_END,this.onClick,this);var e=s.default.getInstance();e.off("booster-updated",this.onBoosterUpdated,this),e.off("booster-action-complete",this.onBoosterUsed,this)},t.prototype.onBoosterUpdated=function(e){var t=e.type,n=e.quantity;t===this.boosterComponent.getBoosterType()&&(this.boosterComponent.quantity=n,this.updateQuantityLabel())},t.prototype.onBoosterUsed=function(e){e===this.boosterComponent.getBoosterType()&&(this.boosterComponent.useOne(),this.updateQuantityLabel())},t.prototype.updateQuantityLabel=function(){this.quantityLabel&&(this.quantityLabel.string=""+this.boosterComponent.quantity)},r([u(c.default)],t.prototype,"boosterComponent",void 0),r([u(cc.Label)],t.prototype,"quantityLabel",void 0),r([l],t)}(cc.Component);n.default=p,cc._RF.pop()},{"../core/events/EventManager":"EventManager","../domain/entities/Booster":"Booster"}],Booster:[function(e,t,n){"use strict";cc._RF.push(t,"696cbVRBzpB+akFp3YVXcQa","Booster");var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../animations/boosters/BoosterAnimator"),c=e("../../core/events/EventManager"),a=e("../../core/types"),l=cc._decorator,u=l.ccclass,p=l.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.quantity=0,t.boosterType=a.BoosterType.Bomb,t}return o(t,e),t.prototype.getBoosterType=function(){return this.boosterType},t.prototype.hasAvailable=function(){return this.quantity>0},t.prototype.useOne=function(){this.hasAvailable()&&(this.quantity--,c.default.getInstance().emit("booster-updated",{type:this.boosterType,quantity:this.quantity}),s.default.animateUse(this.node))},r([p(cc.Integer)],t.prototype,"quantity",void 0),r([p({type:cc.Enum(a.BoosterType)})],t.prototype,"boosterType",void 0),r([u],t)}(cc.Component);n.default=f,cc._RF.pop()},{"../../animations/boosters/BoosterAnimator":"BoosterAnimator","../../core/events/EventManager":"EventManager","../../core/types":"types"}],EndGameScreenAnimator:[function(e,t,n){"use strict";cc._RF.push(t,"6a76annXjZNE61f/HUC2W3r","EndGameScreenAnimator"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(){}return e.show=function(e,t){if(void 0===t&&(t=.3),e){e.scale=.8,e.opacity=0,e.stopAllActions();var n=cc.spawn(cc.scaleTo(t,1).easing(cc.easeBackOut()),cc.fadeIn(t));e.runAction(n)}},e.hide=function(e,t){if(void 0===t&&(t=.2),e){e.stopAllActions();var n=cc.spawn(cc.scaleTo(t,.9).easing(cc.easeIn(.3)),cc.fadeOut(t));e.runAction(n)}},e}();n.default=i,cc._RF.pop()},{}],EventManager:[function(e,t,n){"use strict";cc._RF.push(t,"a8ee0wFFRFO54+B7OC3g+V0","EventManager");var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<n;t++)for(var r=arguments[t],s=0,c=r.length;s<c;s++,o++)i[o]=r[s];return i};Object.defineProperty(n,"__esModule",{value:!0});var c=cc._decorator.ccclass,a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var n;return o(t,e),n=t,t.getInstance=function(){return n.instance},t.prototype.onLoad=function(){n.instance?this.destroy():(n.instance=this,cc.game.addPersistRootNode(this.node))},t.prototype.emit=function(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];(t=this.node).emit.apply(t,s([e],n))},t.prototype.on=function(e,t,n){this.node.on(e,t,n)},t.prototype.off=function(e,t,n){this.node.off(e,t,n)},n=r([c],t)}(cc.Component);n.default=a,cc._RF.pop()},{}],GameStateManager:[function(e,t,n){"use strict";cc._RF.push(t,"e2ea24y/1tA8rOpUW5ppAGH","GameStateManager");var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../events/EventManager"),c=cc._decorator.ccclass,a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._state="playing",t.handleGameWin=function(){t.state="victory"},t.handleGameLose=function(){t.state="defeat"},t.handleGameRestart=function(){t.state="playing"},t}return o(t,e),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(e){this._state!==e&&(this._state=e,s.default.getInstance().emit("game-state-changed",e))},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.setupListeners()},t.prototype.onDestroy=function(){this.destroyListeners()},t.prototype.setupListeners=function(){var e=s.default.getInstance();e.on("game-win",this.handleGameWin,this),e.on("game-lose",this.handleGameLose,this),e.on("game-restart",this.handleGameRestart,this)},t.prototype.destroyListeners=function(){var e=s.default.getInstance();e.off("game-win",this.handleGameWin,this),e.off("game-lose",this.handleGameLose,this),e.off("game-restart",this.handleGameRestart,this)},r([c],t)}(cc.Component);n.default=a,cc._RF.pop()},{"../events/EventManager":"EventManager"}],GameStateUIController:[function(e,t,n){"use strict";cc._RF.push(t,"aaa8a5gOP9MqY39/8NwWDKU","GameStateUIController");var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../animations/ui/EndGameScreenAnimator"),c=e("../events/EventManager"),a=cc._decorator,l=a.ccclass,u=a.property,p={victory:{text:"\u0412\u044b\n\u043f\u043e\u0431\u0435\u0434\u0438\u043b\u0438!",color:new cc.Color(6,138,0,255)},defeat:{text:"\u0412\u044b\n\u043f\u0440\u043e\u0438\u0433\u0440\u0430\u043b\u0438",color:new cc.Color(172,0,0,255)}},f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.endGameScreen=null,t.titleLabel=null,t.restartButton=null,t.handleRestartClick=function(){c.default.getInstance().emit("game-restart")},t}return o(t,e),t.prototype.start=function(){this.hide(),this.setupListeners(),this.setupRestartButton()},t.prototype.onDestroy=function(){this.destroyListeners()},t.prototype.setupListeners=function(){c.default.getInstance().on("game-state-changed",this.onStateChanged,this)},t.prototype.destroyListeners=function(){c.default.getInstance().off("game-state-changed",this.onStateChanged,this),this.restartButton&&this.restartButton.node.off("click",this.handleRestartClick,this)},t.prototype.setupRestartButton=function(){this.restartButton&&this.restartButton.node.on("click",this.handleRestartClick)},t.prototype.onStateChanged=function(e){"playing"===e?this.hide():this.show(e)},t.prototype.show=function(e){var t=p[e];t&&this.endGameScreen&&this.titleLabel&&(this.titleLabel.string=t.text,this.titleLabel.node.color=t.color,this.endGameScreen.active=!0,s.default.show(this.endGameScreen))},t.prototype.hide=function(){var e=this;this.endGameScreen&&(s.default.hide(this.endGameScreen),this.scheduleOnce(function(){return e.endGameScreen.active=!1},.2))},r([u(cc.Node)],t.prototype,"endGameScreen",void 0),r([u(cc.Label)],t.prototype,"titleLabel",void 0),r([u(cc.Button)],t.prototype,"restartButton",void 0),r([l],t)}(cc.Component);n.default=f,cc._RF.pop()},{"../../animations/ui/EndGameScreenAnimator":"EndGameScreenAnimator","../events/EventManager":"EventManager"}],GridAppearAnimator:[function(e,t,n){"use strict";cc._RF.push(t,"5a8c40vKfhGTKUw4OMq2/tD","GridAppearAnimator");var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(t){r(t)}}function c(e){try{a(i.throw(e))}catch(t){r(t)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,c)}a((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(e){return function(t){return a([e,t])}}function a(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(c){r=[6,c],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e){void 0===e&&(e=.35),this.duration=e}return e.prototype.animateGridAppearance=function(e){return i(this,void 0,Promise,function(){var t,n=this;return o(this,function(i){switch(i.label){case 0:return t=[],e.forEachTile(function(i,o){var r=e.getTileAt(i,o);if(r){r.opacity=0,r.scale=.8;var s=cc.fadeIn(n.duration),c=cc.scaleTo(n.duration,1).easing(cc.easeBackOut()),a=cc.spawn(s,c),l=new Promise(function(e){r.runAction(cc.sequence(a,cc.callFunc(e)))});t.push(l)}}),[4,Promise.all(t)];case 1:return i.sent(),[2]}})})},e}();n.default=r,cc._RF.pop()},{}],GridManager:[function(e,t,n){"use strict";cc._RF.push(t,"2dd8a4ufPNJhYcUK2dIe3sk","GridManager");var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(t){r(t)}}function c(e){try{a(i.throw(e))}catch(t){r(t)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,c)}a((i=i.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(e){return function(t){return a([e,t])}}function a(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(c){r=[6,c],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../animations/ui/GridAppearAnimator"),l=e("../../boosters/BoosterManager"),u=e("../../core/events/EventManager"),p=e("../../core/services/PositionService"),f=e("../../data/GridRepository"),h=e("../../data/TileFactory"),d=e("../logic/TileActionExecutor"),y=e("../logic/TileGravityManager"),v=e("./ReshuffleManager"),g=e("./TileMatchManager"),b=e("./TileTurnController"),m=cc._decorator,T=m.ccclass,_=m.property,w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tilePrefab=null,t.gridWidth=0,t.gridHeight=0,t.tileSize=0,t.tileTypesCount=0,t.grid=null,t.positionService=null,t.factory=null,t.matcher=null,t.gravity=null,t.reshuffler=null,t.appearAnimator=null,t.tileActions=null,t.boosterManager=null,t.interactionService=null,t}return o(t,e),t.prototype.start=function(){return s(this,void 0,Promise,function(){return c(this,function(e){switch(e.label){case 0:return this.initServices(),this.setupListeners(),[4,this.createInitialGrid()];case 1:return e.sent(),[4,this.reshuffler.checkAndReshuffle()];case 2:return e.sent(),[2]}})})},t.prototype.onDestroy=function(){this.destroyListeners()},t.prototype.initServices=function(){this.grid=new f.default(this.gridWidth,this.gridHeight,this.tileSize,this.tileTypesCount),this.positionService=new p.default(this.grid),this.factory=new h.default(this.tilePrefab,this.node,this.positionService,this.grid),this.matcher=new g.default(this.grid),this.gravity=new y.default,this.gravity.init(this.grid,this.factory,this.positionService),this.reshuffler=new v.default,this.reshuffler.init(this.grid,this.factory,this.matcher),this.appearAnimator=new a.default,this.tileActions=new d.default(this.grid,this.positionService),this.boosterManager=this.node.addComponent(l.default),this.boosterManager.init(this.grid,this.tileActions),this.interactionService=new b.default(this.grid,this.matcher,this.tileActions,this.gravity,this.reshuffler,this.boosterManager,this.node)},t.prototype.setupListeners=function(){var e=u.default.getInstance();e.on("tile-clicked",this.interactionService.onTileClicked,this.interactionService),e.on("game-restart",this.onGameRestart,this)},t.prototype.destroyListeners=function(){var e=u.default.getInstance();e.off("tile-clicked",this.interactionService.onTileClicked,this.interactionService),e.off("game-restart",this.onGameRestart,this)},t.prototype.createInitialGrid=function(){return s(this,void 0,Promise,function(){return c(this,function(e){switch(e.label){case 0:return this.factory.populateField(this.grid),[4,this.appearAnimator.animateGridAppearance(this.grid)];case 1:return e.sent(),[2]}})})},t.prototype.onGameRestart=function(){return s(this,void 0,Promise,function(){return c(this,function(e){switch(e.label){case 0:return this.clearGrid(),this.reshuffler.reset(),[4,this.createInitialGrid()];case 1:return e.sent(),[2]}})})},t.prototype.clearGrid=function(){var e=this;this.grid&&this.grid.forEachTile(function(t,n){var i=e.grid.getTileAt(t,n);null==i||i.destroy(),e.grid.setTileAt(t,n,null)})},r([_(cc.Prefab)],t.prototype,"tilePrefab",void 0),r([_(cc.Integer)],t.prototype,"gridWidth",void 0),r([_(cc.Integer)],t.prototype,"gridHeight",void 0),r([_(cc.Integer)],t.prototype,"tileSize",void 0),r([_(cc.Integer)],t.prototype,"tileTypesCount",void 0),r([T],t)}(cc.Component);n.default=w,cc._RF.pop()},{"../../animations/ui/GridAppearAnimator":"GridAppearAnimator","../../boosters/BoosterManager":"BoosterManager","../../core/events/EventManager":"EventManager","../../core/services/PositionService":"PositionService","../../data/GridRepository":"GridRepository","../../data/TileFactory":"TileFactory","../logic/TileActionExecutor":"TileActionExecutor","../logic/TileGravityManager":"TileGravityManager","./ReshuffleManager":"ReshuffleManager","./TileMatchManager":"TileMatchManager","./TileTurnController":"TileTurnController"}],GridRepository:[function(e,t,n){"use strict";cc._RF.push(t,"46bc1CkkP1LZJq8EyZjY7Jo","GridRepository"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t,n,i){this.tiles=[],this.width=e,this.height=t,this.tileSize=n,this.tileTypesCount=i,this.tiles=Array.from({length:t},function(){return Array(e).fill(null)})}return e.prototype.getTileAt=function(e,t){var n,i;return(null===(i=null===(n=this.tiles)||void 0===n?void 0:n[t])||void 0===i?void 0:i[e])||null},e.prototype.setTileAt=function(e,t,n){this.isCoordinatesInsideGrid(e,t)&&(this.tiles[t][e]=n)},e.prototype.forEachTile=function(e){for(var t=0;t<this.height;t++)for(var n=0;n<this.width;n++)e(n,t)},e.prototype.someTile=function(e){for(var t=0;t<this.height;t++)for(var n=0;n<this.width;n++)if(e(n,t))return!0;return!1},e.prototype.isCoordinatesInsideGrid=function(e,t){return e>=0&&t>=0&&e<this.width&&t<this.height},e}();n.default=i,cc._RF.pop()},{}],MoveCounterAnimator:[function(e,t,n){"use strict";cc._RF.push(t,"3041eFPnM5NuZW/XeYl8cAz","MoveCounterAnimator"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(){}return e.animateDecrement=function(e){if(e){e.stopAllActions();var t=cc.scaleTo(.15,1.2).easing(cc.easeCubicActionOut()),n=cc.scaleTo(.15,1).easing(cc.easeBackOut()),i=cc.fadeTo(.15,150),o=cc.fadeTo(.15,255),r=cc.spawn(cc.sequence(t,n),cc.sequence(i,o));e.runAction(r)}},e.animateReset=function(e){if(e){e.stopAllActions(),e.opacity=0,e.scale=.8;var t=cc.spawn(cc.fadeIn(.25),cc.scaleTo(.25,1).easing(cc.easeBackOut()));e.runAction(t)}},e}();n.default=i,cc._RF.pop()},{}],MoveManager:[function(e,t,n){"use strict";cc._RF.push(t,"adf67vvHf1PkrfCzioi+YMe","MoveManager");var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../animations/ui/MoveCounterAnimator"),c=e("../events/EventManager"),a=cc._decorator,l=a.ccclass,u=a.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.moveLabel=null,t.initialMoves=37,t.movesCount=0,t}return o(t,e),t.prototype.onLoad=function(){this.resetMoves(),this.updateLabel()},t.prototype.start=function(){this.setupListeners()},t.prototype.onDestroy=function(){this.destroyListeners(),this.resetMoves()},t.prototype.setupListeners=function(){var e=c.default.getInstance();e.on("moves-changed",this.onMovesChanged,this),e.on("game-restart",this.onGameRestart,this)},t.prototype.destroyListeners=function(){var e=c.default.getInstance();e.off("moves-changed",this.onMovesChanged,this),e.off("game-restart",this.onGameRestart,this)},t.prototype.updateLabel=function(){this.moveLabel&&(this.moveLabel.string=String(this.movesCount))},t.prototype.onMovesChanged=function(){this.decrementMove(),this.updateLabel(),this.moveLabel&&s.default.animateDecrement(this.moveLabel.node),this.movesCount<=0&&c.default.getInstance().emit("game-lose")},t.prototype.onGameRestart=function(){this.resetMoves(),this.updateLabel(),this.moveLabel&&s.default.animateReset(this.moveLabel.node)},t.prototype.decrementMove=function(){this.movesCount>0&&this.movesCount--},t.prototype.resetMoves=function(){this.movesCount=this.initialMoves},r([u(cc.Label)],t.prototype,"moveLabel",void 0),r([u(cc.Integer)],t.prototype,"initialMoves",void 0),r([l],t)}(cc.Component);n.default=p,cc._RF.pop()},{"../../animations/ui/MoveCounterAnimator":"MoveCounterAnimator","../events/EventManager":"EventManager"}],PositionService:[function(e,t,n){"use strict";cc._RF.push(t,"c0825ixN55Kkq32ufh0FD4m","PositionService"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e){this.grid=e}return e.prototype.getTileWorldPosition=function(e,t){var n=this.grid.width*this.grid.tileSize,i=this.grid.height*this.grid.tileSize,o=n/2-this.grid.tileSize/2,r=i/2-this.grid.tileSize/2;return cc.v2(e*this.grid.tileSize-o,t*this.grid.tileSize-r)},e}();n.default=i,cc._RF.pop()},{}],ReshuffleManager:[function(e,t,n){"use strict";cc._RF.push(t,"2f39atwlaxAg4PFZIsbo1O5","ReshuffleManager");var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(t){r(t)}}function c(e){try{a(i.throw(e))}catch(t){r(t)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,c)}a((i=i.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(e){return function(t){return a([e,t])}}function a(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(c){r=[6,c],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../animations/ui/GridAppearAnimator"),l=e("../../core/events/EventManager"),u=e("../entities/Tile"),p=cc._decorator.ccclass,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.maxReshuffles=3,t.reshuffleCount=0,t.appearAnimator=new a.default,t.grid=null,t.factory=null,t.matcher=null,t}return o(t,e),t.prototype.init=function(e,t,n){this.grid=e,this.factory=t,this.matcher=n},t.prototype.checkAndReshuffle=function(){return s(this,void 0,Promise,function(){return c(this,function(e){switch(e.label){case 0:return this.hasAvailableMoves()?[2,!0]:this.reshuffleCount>=this.maxReshuffles?(l.default.getInstance().emit("game-lose"),[2,!1]):[4,this.reshuffleField()];case 1:return e.sent(),[2,this.checkAndReshuffle()]}})})},t.prototype.hasAvailableMoves=function(){var e=this;return!(!this.grid||!this.matcher)&&this.grid.someTile(function(t,n){var i=e.grid.getTileAt(t,n).getComponent(u.default);return!!i&&e.matcher.findConnectedTiles(t,n,i.getTileType()).length>=2})},t.prototype.reshuffleField=function(){return s(this,void 0,Promise,function(){return c(this,function(e){switch(e.label){case 0:return this.grid&&this.factory?(this.reshuffleCount++,this.clearField(),this.factory.populateField(this.grid),[4,this.appearAnimator.animateGridAppearance(this.grid)]):[2];case 1:return e.sent(),[2]}})})},t.prototype.clearField=function(){var e=this;this.grid&&this.grid.forEachTile(function(t,n){var i=e.grid.getTileAt(t,n);null==i||i.destroy(),e.grid.setTileAt(t,n,null)})},t.prototype.reset=function(){this.reshuffleCount=0},r([p],t)}(cc.Component);n.default=f,cc._RF.pop()},{"../../animations/ui/GridAppearAnimator":"GridAppearAnimator","../../core/events/EventManager":"EventManager","../entities/Tile":"Tile"}],ScoreAnimator:[function(e,t,n){"use strict";cc._RF.push(t,"061ben6R8ZH+YAGKdEBy4bA","ScoreAnimator"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(){}return e.animateScoreChange=function(e,t,n){if(e){e.stopAllActions();var i=cc.scaleTo(.15,1.25).easing(cc.easeCubicActionOut()),o=cc.scaleTo(.15,1).easing(cc.easeBackOut()),r=cc.sequence(i,o),s=n>t?cc.tintTo(.15,0,255,120):cc.tintTo(.15,255,255,255),c=cc.tintTo(.15,255,255,255);e.runAction(cc.sequence(cc.spawn(r,s),c))}},e.animateReset=function(e){if(e){e.stopAllActions(),e.opacity=0,e.scale=.8;var t=cc.spawn(cc.fadeIn(.25),cc.scaleTo(.25,1).easing(cc.easeBackOut()));e.runAction(t)}},e}();n.default=i,cc._RF.pop()},{}],ScoreManager:[function(e,t,n){"use strict";cc._RF.push(t,"042ebiihqBKB6cDdZGn/5tO","ScoreManager");var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../animations/ui/ScoreAnimator"),c=e("../events/EventManager"),a=cc._decorator,l=a.ccclass,u=a.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.scoreLabel=null,t.totalScore=500,t.earnedScore=0,t}return o(t,e),t.prototype.start=function(){this.updateLabel(),this.setupListeners()},t.prototype.onDestroy=function(){this.destroyListeners(),this.resetScore()},t.prototype.setupListeners=function(){var e=c.default.getInstance();e.on("score-changed",this.onScoreChanged,this),e.on("game-restart",this.onGameRestart,this)},t.prototype.destroyListeners=function(){var e=c.default.getInstance();e.off("score-changed",this.onScoreChanged,this),e.off("game-restart",this.onGameRestart,this)},t.prototype.onGameRestart=function(){this.resetScore(),this.updateLabel(),this.scoreLabel&&s.default.animateReset(this.scoreLabel.node)},t.prototype.onScoreChanged=function(e){var t=this.earnedScore;this.earnedScore=Math.min(this.earnedScore+e,this.totalScore),this.updateLabel(),this.scoreLabel&&s.default.animateScoreChange(this.scoreLabel.node,t,this.earnedScore),this.earnedScore>=this.totalScore&&c.default.getInstance().emit("game-win")},t.prototype.updateLabel=function(){this.scoreLabel&&(this.scoreLabel.string=this.earnedScore+"/"+this.totalScore)},t.prototype.resetScore=function(){this.earnedScore=0},r([u(cc.Label)],t.prototype,"scoreLabel",void 0),r([u(cc.Integer)],t.prototype,"totalScore",void 0),r([u(cc.Integer)],t.prototype,"earnedScore",void 0),r([l],t)}(cc.Component);n.default=p,cc._RF.pop()},{"../../animations/ui/ScoreAnimator":"ScoreAnimator","../events/EventManager":"EventManager"}],TileActionExecutor:[function(e,t,n){"use strict";cc._RF.push(t,"8dab3JyZWVEwKJeubgTTBSV","TileActionExecutor");var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(t){r(t)}}function c(e){try{a(i.throw(e))}catch(t){r(t)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,c)}a((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(e){return function(t){return a([e,t])}}function a(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(c){r=[6,c],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var r=e("./TileEffectResolver"),s=e("./TileDestroyer"),c=e("./TileChainProcessor"),a=e("../../core/types"),l=e("../entities/Tile"),u=e("../../animations/tiles/TileAnimator"),p=function(){function e(e,t){this.grid=e,this.positionService=t,this.effects=new r.default(e),this.destroyer=new s.default(e),this.chainProcessor=new c.default(e,this.effects,this.destroyer)}return e.prototype.destroyConnectedTiles=function(e,t,n){return i(this,void 0,Promise,function(){var i,r,s;return o(this,function(){return i=this.determineSpecialType(e.length),r=i!==a.TileSpecialType.None,s=r?e.filter(function(e){var i=e.x,o=e.y;return!(i===t&&o===n)}):e,r&&this.createSpecialTileAt(t,n,i),[2,this.chainProcessor.processChain(s)]})})},e.prototype.activateSpecialTile=function(e){return i(this,void 0,Promise,function(){var t;return o(this,function(){return t=this.effects.resolve(e.getSpecialType(),e.getGridPosition()),[2,this.chainProcessor.processChain(t)]})})},e.prototype.createSpecialTileAt=function(e,t,n){var i=this.grid.getTileAt(e,t),o=null==i?void 0:i.getComponent(l.default);o&&(o.transformToSpecial(n),u.default.animateSpecialTileCreate(i))},e.prototype.swapTiles=function(e,t){return i(this,void 0,Promise,function(){var n,i,r,s;return o(this,function(){return n=this.positionService.getTileWorldPosition(e.getGridPosition().x,e.getGridPosition().y),i=this.positionService.getTileWorldPosition(t.getGridPosition().x,t.getGridPosition().y),e.node.setPosition(i),t.node.setPosition(n),r=e.getGridPosition(),s=t.getGridPosition(),this.grid.setTileAt(s.x,s.y,e.node),this.grid.setTileAt(r.x,r.y,t.node),e.setGridPosition(s.x,s.y),t.setGridPosition(r.x,r.y),[2]})})},e.prototype.determineSpecialType=function(e){return e>=9?a.TileSpecialType.SuperBomb:e>=6?Math.random()<.5?a.TileSpecialType.RowRocket:a.TileSpecialType.ColRocket:e>=5?a.TileSpecialType.Bomb:a.TileSpecialType.None},e.prototype.destroyTilesWithChain=function(e){return i(this,void 0,Promise,function(){return o(this,function(){return[2,this.chainProcessor.processChain(e)]})})},e}();n.default=p,cc._RF.pop()},{"../../animations/tiles/TileAnimator":"TileAnimator","../../core/types":"types","../entities/Tile":"Tile","./TileChainProcessor":"TileChainProcessor","./TileDestroyer":"TileDestroyer","./TileEffectResolver":"TileEffectResolver"}],TileAnimator:[function(e,t,n){"use strict";cc._RF.push(t,"1a9826ZP8tFUreSrUAn1ata","TileAnimator"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(){}return e.animateFall=function(e,t,n){return void 0===n&&(n=.25),e?new Promise(function(i){e.runAction(cc.sequence(cc.moveTo(n,t).easing(cc.easeCubicActionOut()),cc.callFunc(function(){return i()})))}):Promise.resolve()},e.animateSwap=function(e,t){return e&&t?new Promise(function(n){var i=e.getPosition(),o=t.getPosition(),r=cc.scaleTo(.1,1.1).easing(cc.easeSineOut()),s=cc.scaleTo(.1,1).easing(cc.easeSineIn()),c=cc.moveTo(.25,o).easing(cc.easeCubicActionOut()),a=cc.moveTo(.25,i).easing(cc.easeCubicActionOut()),l=cc.sequence(r,c,s),u=cc.sequence(r.clone(),a,s.clone());e.runAction(l),t.runAction(u),e.runAction(cc.sequence(cc.delayTime(.35),cc.callFunc(function(){return n()})))}):Promise.resolve()},e.animateDestroy=function(e,t){return void 0===t&&(t=.25),new Promise(function(n){var i=cc.fadeOut(t),o=cc.scaleTo(t,0).easing(cc.easeBackIn()),r=cc.rotateBy(t,360*Math.random()*(Math.random()>.5?1:-1)),s=cc.spawn(i,o,r);e.runAction(cc.sequence(s,cc.callFunc(n)))})},e.animateSpecialTileCreate=function(e){return e?new Promise(function(t){e.scale=.8,e.opacity=0;var n=cc.fadeIn(.18),i=cc.scaleTo(.18,1).easing(cc.easeBackOut()),o=cc.spawn(n,i);e.runAction(cc.sequence(o,cc.callFunc(t)))}):Promise.resolve()},e.animateSpawn=function(e,t,n){return void 0===n&&(n=.1),e?new Promise(function(i){e.opacity=0,e.scale=.8;var o=cc.fadeIn(n),r=cc.moveTo(n,t).easing(cc.easeCubicActionOut()),s=cc.scaleTo(n,1).easing(cc.easeBackOut()),c=cc.spawn(o,r,s);e.runAction(cc.sequence(c,cc.callFunc(i)))}):Promise.resolve()},e}();n.default=i,cc._RF.pop()},{}],TileChainProcessor:[function(e,t,n){"use strict";cc._RF.push(t,"ab671wfQh9Ar6IoplU1u2rO","TileChainProcessor");var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(t){r(t)}}function c(e){try{a(i.throw(e))}catch(t){r(t)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,c)}a((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(e){return function(t){return a([e,t])}}function a(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(c){r=[6,c],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<n;t++)for(var r=arguments[t],s=0,c=r.length;s<c;s++,o++)i[o]=r[s];return i};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../entities/Tile"),c=function(){function e(e,t,n){this.grid=e,this.resolver=t,this.destroyer=n}return e.prototype.processChain=function(e){return i(this,void 0,Promise,function(){var t,n,i,c,a,l,u,p,f,h,d,y;return o(this,function(o){switch(o.label){case 0:for(t=new Set,n=r(e),i=[];n.length>0;)if(c=n.shift(),a=c.x+"_"+c.y,!t.has(a)&&(t.add(a),(l=this.grid.getTileAt(c.x,c.y))&&(u=l.getComponent(s.default))&&(i.push(c),u.isSpecial())))for(p=this.resolver.resolve(u.getSpecialType(),c),f=0,h=p;f<h.length;f++)d=h[f],y=d.x+"_"+d.y,t.has(y)||n.push(d);return[4,this.destroyer.destroyTiles(i)];case 1:return[2,o.sent()]}})})},e}();n.default=c,cc._RF.pop()},{"../entities/Tile":"Tile"}],TileDestroyer:[function(e,t,n){"use strict";cc._RF.push(t,"7b1a7Yxla1GDItSycpM9b7Y","TileDestroyer");var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(t){r(t)}}function c(e){try{a(i.throw(e))}catch(t){r(t)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,c)}a((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(e){return function(t){return a([e,t])}}function a(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(c){r=[6,c],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../animations/tiles/TileAnimator"),s=e("../entities/Tile"),c=function(){function e(e){this.grid=e}return e.prototype.destroyTiles=function(e){return i(this,void 0,Promise,function(){var t,n=this;return o(this,function(c){switch(c.label){case 0:return t=0,[4,Promise.all(e.map(function(e){var c=e.x,a=e.y;return i(n,void 0,void 0,function(){var e,n;return o(this,function(i){switch(i.label){case 0:return(e=this.grid.getTileAt(c,a))?(n=e.getComponent(s.default))?[4,n.destroyTile()]:[3,2]:[2];case 1:return i.sent(),[3,4];case 2:return[4,r.default.animateDestroy(e,.15)];case 3:i.sent(),e.destroy(),i.label=4;case 4:return this.grid.setTileAt(c,a,null),t++,[2]}})})}))];case 1:return c.sent(),[2,10*t]}})})},e}();n.default=c,cc._RF.pop()},{"../../animations/tiles/TileAnimator":"TileAnimator","../entities/Tile":"Tile"}],TileEffectResolver:[function(e,t,n){"use strict";cc._RF.push(t,"93f88eiARNIeIyUjWVh2Omm","TileEffectResolver"),Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../core/types"),o=function(){function e(e){this.grid=e}return e.prototype.resolve=function(e,t){var n=t.x,o=t.y,r=[];switch(e){case i.TileSpecialType.Bomb:this.collectRadius(n,o,1,r);break;case i.TileSpecialType.RowRocket:for(var s=0;s<this.grid.width;s++)r.push({x:s,y:o});break;case i.TileSpecialType.ColRocket:for(var c=0;c<this.grid.height;c++)r.push({x:n,y:c});break;case i.TileSpecialType.SuperBomb:this.grid.forEachTile(function(e,t){return r.push({x:e,y:t})})}return r},e.prototype.collectRadius=function(e,t,n,i){for(var o=-n;o<=n;o++)for(var r=-n;r<=n;r++){var s=e+o,c=t+r;this.grid.isCoordinatesInsideGrid(s,c)&&i.push({x:s,y:c})}},e}();n.default=o,cc._RF.pop()},{"../../core/types":"types"}],TileFactory:[function(e,t,n){"use strict";cc._RF.push(t,"ffe0670LXBJ5Lfk2ZAsSaXn","TileFactory");var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(t){r(t)}}function c(e){try{a(i.throw(e))}catch(t){r(t)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,c)}a((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(e){return function(t){return a([e,t])}}function a(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(c){r=[6,c],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var r=e("../animations/tiles/TileAnimator"),s=e("../core/types"),c=e("../domain/entities/Tile"),a=function(){function e(e,t,n,i){this.tilePrefab=e,this.parentNode=t,this.positionService=n,this.grid=i}return e.prototype.createTile=function(e,t,n,i,o){void 0===n&&(n=null),void 0===i&&(i=s.TileSpecialType.None),void 0===o&&(o=!1);var a=cc.instantiate(this.tilePrefab),l=a.getComponent(c.default);if(!l)throw new Error("Tile component missing on prefab");a.parent=this.parentNode,l.init(e,t,n||this.getRandomTileType(),this.positionService,i);var u=this.positionService.getTileWorldPosition(e,t);return a.setPosition(u),this.grid.setTileAt(e,t,a),o&&r.default.animateSpawn(a,u),a},e.prototype.createFallingTile=function(e,t,n,a,l){return void 0===l&&(l=s.TileSpecialType.None),i(this,void 0,Promise,function(){var i,s,u,p;return o(this,function(o){switch(o.label){case 0:if((i=cc.instantiate(this.tilePrefab)).parent=this.parentNode,!(s=i.getComponent(c.default)))throw new Error("Tile component missing on prefab");return s.init(e,n,a,this.positionService,l),u=this.positionService.getTileWorldPosition(e,t),p=this.positionService.getTileWorldPosition(e,n),i.setPosition(u),[4,r.default.animateFall(i,p)];case 1:return o.sent(),this.grid.setTileAt(e,n,i),[2]}})})},e.prototype.populateField=function(e){var t=this;this.grid.forEachTile(function(n,i){var o=t.createTile(n,i);o.setPosition(t.positionService.getTileWorldPosition(n,i)),e.setTileAt(n,i,o)})},e.prototype.getRandomTileType=function(){return Math.floor(Math.random()*this.grid.tileTypesCount)},e}();n.default=a,cc._RF.pop()},{"../animations/tiles/TileAnimator":"TileAnimator","../core/types":"types","../domain/entities/Tile":"Tile"}],TileGravityManager:[function(e,t,n){"use strict";cc._RF.push(t,"b3ba2+820tGq6moRAply4Sd","TileGravityManager");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(t){r(t)}}function c(e){try{a(i.throw(e))}catch(t){r(t)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,c)}a((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(e){return function(t){return a([e,t])}}function a(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(c){r=[6,c],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../animations/tiles/TileAnimator"),c=e("../entities/Tile"),a=cc._decorator.ccclass,l=function(){function e(){this.grid=null,this.factory=null,this.positionService=null}return e.prototype.init=function(e,t,n){this.grid=e,this.factory=t,this.positionService=n},e.prototype.applyGravity=function(){return o(this,void 0,Promise,function(){var e,t,n,i,o,s,a,l,u,p,f;return r(this,function(r){switch(r.label){case 0:if(!this.grid)return[2];for(e=[],t=0;t<this.grid.width;t++){for(n=0,i=0;i<this.grid.height;i++)(o=this.grid.getTileAt(t,i))?n>0&&(s=i-n,(a=o.getComponent(c.default))&&(f=a.moveToGrid(t,s),e.push(f)),this.grid.setTileAt(t,s,o),this.grid.setTileAt(t,i,null)):n++;for(l=0;l<n;l++)u=this.grid.height+l,p=this.grid.height-n+l,f=this.createFallingTile(t,u,p),e.push(f)}return[4,Promise.all(e)];case 1:return r.sent(),[2]}})})},e.prototype.createFallingTile=function(e,t,n){return o(this,void 0,Promise,function(){var i,o,c;return r(this,function(r){switch(r.label){case 0:return i=this.factory.createTile(e,n),o=this.positionService.getTileWorldPosition(e,t),i.setPosition(o),c=this.positionService.getTileWorldPosition(e,n),[4,s.default.animateFall(i,c)];case 1:return r.sent(),i.setPosition(c),this.grid.setTileAt(e,n,i),[2]}})})},i([a],e)}();n.default=l,cc._RF.pop()},{"../../animations/tiles/TileAnimator":"TileAnimator","../entities/Tile":"Tile"}],TileMatchManager:[function(e,t,n){"use strict";cc._RF.push(t,"9bd5dDefbpI3aYvCI1YOj13","TileMatchManager"),Object.defineProperty(n,"__esModule",{value:!0});var i=e("../entities/Tile"),o=function(){function e(e){this.grid=e}return e.prototype.findConnectedTiles=function(e,t,n){for(var o=new Set,r=[{x:e,y:t}],s=[],c=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}];r.length;){var a=r.pop();if(a){var l=a.x+"_"+a.y;if(!o.has(l)){o.add(l);var u=this.grid.getTileAt(a.x,a.y),p=null==u?void 0:u.getComponent(i.default);if(p&&p.getTileType()===n){s.push(a);for(var f=0,h=c;f<h.length;f++){var d=h[f],y=d.dx,v=d.dy,g=a.x+y,b=a.y+v;g>=0&&g<this.grid.width&&b>=0&&b<this.grid.height&&r.push({x:g,y:b})}}}}}return s},e}();n.default=o,cc._RF.pop()},{"../entities/Tile":"Tile"}],TileTurnController:[function(e,t,n){"use strict";cc._RF.push(t,"6c6723lXFRDxLMU12g6dwuh","TileTurnController");var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(t){r(t)}}function c(e){try{a(i.throw(e))}catch(t){r(t)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,c)}a((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(e){return function(t){return a([e,t])}}function a(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(c){r=[6,c],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../core/events/EventManager"),s=e("../../core/types"),c=e("../entities/Tile"),a=function(){function e(e,t,n,i,o,r,s){this.grid=e,this.matcher=t,this.tileActions=n,this.gravity=i,this.reshuffler=o,this.boosterManager=r,this.gridNode=s,this.isProcessing=!1}return e.prototype.onTileClicked=function(e){var t=e.x,n=e.y,s=e.tileType;return i(this,void 0,void 0,function(){var e;return o(this,function(i){switch(i.label){case 0:if(this.isProcessing)return[2];this.isProcessing=!0,i.label=1;case 1:return i.trys.push([1,,5,7]),[4,this.tryHandleBooster(t,n)];case 2:return i.sent()?[2]:(r.default.getInstance().emit("moves-changed"),(e=this.getTile(t,n))?[4,this.tryHandleSpecial(e)]:[2]);case 3:return i.sent()?[2]:[4,this.tryHandleConnected(t,n,s)];case 4:return i.sent(),[3,7];case 5:return[4,this.finalizeTurn()];case 6:return i.sent(),[7];case 7:return[2]}})})},e.prototype.getTile=function(e,t){var n,i=this.grid.getTileAt(e,t);return null!==(n=null==i?void 0:i.getComponent(c.default))&&void 0!==n?n:null},e.prototype.tryHandleBooster=function(e,t){return i(this,void 0,Promise,function(){return o(this,function(n){switch(n.label){case 0:return null===this.boosterManager.activeBoosterType?[2,!1]:[4,this.boosterManager.handleBoosterUsage(e,t)];case 1:return n.sent(),[2,!0]}})})},e.prototype.tryHandleSpecial=function(e){return i(this,void 0,Promise,function(){var t;return o(this,function(n){switch(n.label){case 0:return e.getSpecialType()===s.TileSpecialType.None?[2,!1]:[4,this.tileActions.activateSpecialTile(e)];case 1:return t=n.sent(),r.default.getInstance().emit("score-changed",t),[2,!0]}})})},e.prototype.tryHandleConnected=function(e,t,n){return i(this,void 0,Promise,function(){var i,s;return o(this,function(o){switch(o.label){case 0:return(i=this.matcher.findConnectedTiles(e,t,n)).length<2?[2]:[4,this.tileActions.destroyConnectedTiles(i,e,t)];case 1:return s=o.sent(),r.default.getInstance().emit("score-changed",s),[2]}})})},e.prototype.finalizeTurn=function(){return i(this,void 0,Promise,function(){return o(this,function(e){switch(e.label){case 0:return[4,this.gravity.applyGravity()];case 1:return e.sent(),[4,this.reshuffler.checkAndReshuffle()];case 2:return e.sent(),this.resortTilesByDepth(),this.isProcessing=!1,[2]}})})},e.prototype.resortTilesByDepth=function(){this.gridNode.children.forEach(function(e){e.zIndex=+e.y})},e}();n.default=a,cc._RF.pop()},{"../../core/events/EventManager":"EventManager","../../core/types":"types","../entities/Tile":"Tile"}],Tile:[function(e,t,n){"use strict";cc._RF.push(t,"e0baamQ7/9KnL6Y7zqCTE8p","Tile");var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(t){r(t)}}function c(e){try{a(i.throw(e))}catch(t){r(t)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,c)}a((i=i.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(e){return function(t){return a([e,t])}}function a(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(c){r=[6,c],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../animations/tiles/TileAnimator"),l=e("../../core/events/EventManager"),u=e("../../core/types"),p=cc._decorator,f=p.ccclass,h=p.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tileSprites=[],t.specialSprites=[],t.sprite=null,t.positionService=null,t.tileType=0,t.specialType=u.TileSpecialType.None,t.gridX=0,t.gridY=0,t}return o(t,e),t.prototype.init=function(e,t,n,i,o){void 0===o&&(o=u.TileSpecialType.None),this.gridX=e,this.gridY=t,this.tileType=n,this.specialType=o,this.positionService=i},t.prototype.start=function(){this.updateSprite()},t.prototype.onLoad=function(){this.sprite=this.getComponent(cc.Sprite),this.setupListeners()},t.prototype.onDestroy=function(){this.destroyListeners()},t.prototype.setupListeners=function(){this.node.on(cc.Node.EventType.TOUCH_END,this.onClick,this)},t.prototype.destroyListeners=function(){this.node.off(cc.Node.EventType.TOUCH_END,this.onClick,this)},t.prototype.getGridPosition=function(){return{x:this.gridX,y:this.gridY}},t.prototype.setGridPosition=function(e,t){this.gridX=e,this.gridY=t},t.prototype.getTileType=function(){return this.tileType},t.prototype.getSpecialType=function(){return this.specialType},t.prototype.isSpecial=function(){return this.specialType!==u.TileSpecialType.None},t.prototype.moveToGrid=function(e,t){return s(this,void 0,Promise,function(){var n;return c(this,function(i){switch(i.label){case 0:return this.positionService?(this.gridX=e,this.gridY=t,n=this.positionService.getTileWorldPosition(e,t),[4,a.default.animateFall(this.node,n)]):[2];case 1:return i.sent(),[2]}})})},t.prototype.destroyTile=function(e){return void 0===e&&(e=.15),s(this,void 0,Promise,function(){return c(this,function(t){switch(t.label){case 0:return[4,a.default.animateDestroy(this.node,e)];case 1:return t.sent(),this.node.destroy(),[2]}})})},t.prototype.transformToSpecial=function(e){this.specialType=e,this.tileType=null,this.updateSprite()},t.prototype.onClick=function(){l.default.getInstance().emit("tile-clicked",{x:this.gridX,y:this.gridY,tileType:this.tileType,specialType:this.specialType})},t.prototype.updateSprite=function(){this.sprite&&(this.isSpecial()&&this.specialSprites[this.specialType]?this.sprite.spriteFrame=this.specialSprites[this.specialType]:this.tileSprites[this.tileType]&&(this.sprite.spriteFrame=this.tileSprites[this.tileType]))},r([h([cc.SpriteFrame])],t.prototype,"tileSprites",void 0),r([h([cc.SpriteFrame])],t.prototype,"specialSprites",void 0),r([f],t)}(cc.Component);n.default=d,cc._RF.pop()},{"../../animations/tiles/TileAnimator":"TileAnimator","../../core/events/EventManager":"EventManager","../../core/types":"types"}],types:[function(e,t,n){"use strict";cc._RF.push(t,"cd7f7KZW8VCcb55XaXGqnMe","types"),Object.defineProperty(n,"__esModule",{value:!0}),n.BoosterType=n.TileSpecialType=void 0,function(e){e[e.None=0]="None",e[e.Bomb=1]="Bomb",e[e.RowRocket=2]="RowRocket",e[e.ColRocket=3]="ColRocket",e[e.SuperBomb=4]="SuperBomb"}(n.TileSpecialType||(n.TileSpecialType={})),function(e){e[e.Bomb=0]="Bomb",e[e.Teleport=1]="Teleport"}(n.BoosterType||(n.BoosterType={})),cc._RF.pop()},{}]},{},["BoosterAnimator","TileAnimator","EndGameScreenAnimator","GridAppearAnimator","MoveCounterAnimator","ScoreAnimator","BoosterManager","BoosterUI","EventManager","GameStateManager","GameStateUIController","MoveManager","ScoreManager","PositionService","types","GridRepository","TileFactory","Booster","Tile","TileActionExecutor","TileChainProcessor","TileDestroyer","TileEffectResolver","TileGravityManager","GridManager","ReshuffleManager","TileMatchManager","TileTurnController"]);